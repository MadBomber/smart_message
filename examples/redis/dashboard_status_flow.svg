<?xml version="1.0" encoding="UTF-8"?>
<svg width="800" height="500" viewBox="0 0 800 500" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .bg { fill: transparent; }
      .data-group { fill: #1a2a1a; stroke: #4aff4a; stroke-width: 2; rx: 8; }
      .process-group { fill: #2a1a2a; stroke: #aa4aff; stroke-width: 2; rx: 8; }
      .output-group { fill: #2a2a1a; stroke: #ffaa4a; stroke-width: 2; rx: 8; }
      .component { fill: #3a3a3a; stroke: #ffffff; stroke-width: 1; rx: 4; }
      .flow { stroke: #4aff4a; stroke-width: 2; fill: none; marker-end: url(#arrowhead-green); }
      .process-flow { stroke: #aa4aff; stroke-width: 2; fill: none; marker-end: url(#arrowhead-purple); }
      .output-flow { stroke: #ffaa4a; stroke-width: 3; fill: none; marker-end: url(#arrowhead-orange); }
      .text { fill: #ffffff; font-family: 'Arial', sans-serif; font-size: 11px; }
      .title { fill: #4a9eff; font-family: 'Arial', sans-serif; font-size: 18px; font-weight: bold; }
      .subtitle { fill: #ffaa4a; font-family: 'Arial', sans-serif; font-size: 12px; }
      .group-title { fill: #ffffff; font-family: 'Arial', sans-serif; font-size: 13px; font-weight: bold; }
    </style>
    <marker id="arrowhead-green" markerWidth="8" markerHeight="6" 
            refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#4aff4a" />
    </marker>
    <marker id="arrowhead-purple" markerWidth="8" markerHeight="6" 
            refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#aa4aff" />
    </marker>
    <marker id="arrowhead-orange" markerWidth="8" markerHeight="6" 
            refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#ffaa4a" />
    </marker>
  </defs>
  
  <!-- Background -->
  <rect class="bg" width="800" height="500"/>
  
  <!-- Title -->
  <text x="400" y="25" text-anchor="middle" class="title">Dashboard Status Flow</text>
  <text x="400" y="45" text-anchor="middle" class="subtitle">System Status Aggregation and Periodic Reporting</text>
  
  <!-- Data Collection Group -->
  <rect x="50" y="80" width="200" height="180" class="data-group"/>
  <text x="150" y="105" text-anchor="middle" class="group-title">Data Collection</text>
  
  <rect x="70" y="120" width="160" height="30" class="component"/>
  <text x="150" y="140" text-anchor="middle" class="text">Device Last Seen Times</text>
  
  <rect x="70" y="160" width="160" height="30" class="component"/>
  <text x="150" y="180" text-anchor="middle" class="text">Alert Counts</text>
  
  <rect x="70" y="200" width="160" height="30" class="component"/>
  <text x="150" y="220" text-anchor="middle" class="text">Battery Levels</text>
  
  <rect x="70" y="240" width="160" height="30" class="component"/>
  <text x="150" y="260" text-anchor="middle" class="text">System Health</text>
  
  <!-- Status Processing Group -->
  <rect x="300" y="80" width="200" height="180" class="process-group"/>
  <text x="400" y="105" text-anchor="middle" class="group-title">Status Processing</text>
  
  <rect x="320" y="120" width="160" height="40" class="component"/>
  <text x="400" y="140" text-anchor="middle" class="text">Count Active Devices</text>
  <text x="400" y="155" text-anchor="middle" class="text">last_seen &lt; 30s</text>
  
  <rect x="320" y="170" width="160" height="40" class="component"/>
  <text x="400" y="190" text-anchor="middle" class="text">Count Recent Alerts</text>
  <text x="400" y="205" text-anchor="middle" class="text">last 5 minutes</text>
  
  <rect x="320" y="220" width="160" height="30" class="component"/>
  <text x="400" y="240" text-anchor="middle" class="text">Calculate Averages</text>
  
  <!-- Status Output Group -->
  <rect x="550" y="80" width="200" height="180" class="output-group"/>
  <text x="650" y="105" text-anchor="middle" class="group-title">Status Output</text>
  
  <rect x="570" y="140" width="160" height="60" class="component"/>
  <text x="650" y="165" text-anchor="middle" class="text">DashboardStatusMessage</text>
  <text x="650" y="185" text-anchor="middle" class="text">Every 10 seconds</text>
  
  <!-- Flow arrows -->
  <path d="M 250 150 L 300 140" class="flow"/>
  <path d="M 250 180 L 300 190" class="flow"/>
  <path d="M 250 210 L 300 235" class="flow"/>
  <path d="M 250 240 L 300 235" class="flow"/>
  
  <path d="M 500 140 L 550 170" class="process-flow"/>
  <path d="M 500 190 L 550 170" class="process-flow"/>
  <path d="M 500 235 L 550 170" class="process-flow"/>
  
  <!-- Status Message Details -->
  <rect x="50" y="300" width="700" height="180" fill="#1a1a1a" stroke="#4a9eff" rx="8"/>
  <text x="70" y="325" class="title">Dashboard Status Message Content</text>
  
  <text x="70" y="350" class="text">ðŸ“Š System Metrics (Updated every 10 seconds):</text>
  <text x="90" y="365" class="subtitle">â€¢ Active device count: Devices that have reported within last 30 seconds</text>
  <text x="90" y="380" class="subtitle">â€¢ Total alert count: Alerts generated in the last 5 minutes</text>
  <text x="90" y="395" class="subtitle">â€¢ Average battery level: Calculated across all battery-powered devices</text>
  <text x="90" y="410" class="subtitle">â€¢ System health score: Composite metric based on device availability</text>
  
  <text x="400" y="350" class="text">ðŸ”„ Processing Logic:</text>
  <text x="420" y="365" class="subtitle">â€¢ Device activity tracking: Timestamp comparison for online status</text>
  <text x="420" y="380" class="subtitle">â€¢ Alert aggregation: Count and categorize alerts by severity</text>
  <text x="420" y="395" class="subtitle">â€¢ Performance calculation: Battery levels, response times, error rates</text>
  <text x="420" y="410" class="subtitle">â€¢ Status publication: Broadcast to all subscribers for system visibility</text>
  
  <text x="70" y="440" class="text">ðŸ“ˆ Status Message Format:</text>
  <text x="90" y="455" class="subtitle">â€¢ device_count: 3, alert_count: 2, avg_battery: 78.5%, health_score: "good"</text>
  <text x="90" y="470" class="subtitle">â€¢ Subscribers: Mobile apps, monitoring systems, other dashboards</text>
</svg>