
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Intelligent messages that know what to do and how to do it">
      
      
        <meta name="author" content="madbomber">
      
      
        <link rel="canonical" href="https://madbomber.github.io/smart_message/transports/redis-queue-transport/">
      
      
        <link rel="prev" href="../redis-enhanced-transport/">
      
      
        <link rel="next" href="../redis-transport-comparison/">
      
      
      <link rel="icon" href="../../assets/smart_message.jpg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>Redis Queue Transport - SmartMessage Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="brown" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#redis-queue-transport" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="SmartMessage Documentation" class="md-header__button md-logo" aria-label="SmartMessage Documentation" data-md-component="logo">
      
  <img src="../../assets/smart_message.jpg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SmartMessage Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Redis Queue Transport
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="brown" data-md-color-accent="amber"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="brown" data-md-color-accent="amber"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/madbomber/smart_message" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    madbomber/smart_message
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../getting-started/quick-start/" class="md-tabs__link">
          
  
  
    
  
  üöÄ Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../core-concepts/architecture/" class="md-tabs__link">
          
  
  
    
  
  üìñ Core Concepts

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../reference/transports/" class="md-tabs__link">
          
  
  
    
  
  üîå Reference

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../memory-transport/" class="md-tabs__link">
          
  
  
    
  
  üöö Transports

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../guides/redis-queue-getting-started/" class="md-tabs__link">
          
  
  
    
  
  üìö Guides

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../development/troubleshooting/" class="md-tabs__link">
          
  
  
    
  
  ‚öôÔ∏è Development

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="SmartMessage Documentation" class="md-nav__button md-logo" aria-label="SmartMessage Documentation" data-md-component="logo">
      
  <img src="../../assets/smart_message.jpg" alt="logo">

    </a>
    SmartMessage Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/madbomber/smart_message" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    madbomber/smart_message
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    üöÄ Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            üöÄ Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/quick-start/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quick Start
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    üìñ Core Concepts
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            üìñ Core Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../core-concepts/architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../core-concepts/properties/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Properties
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../core-concepts/addressing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Addressing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../core-concepts/dispatcher/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dispatcher
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../core-concepts/message-filtering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Message Filtering
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../core-concepts/message-processing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Message Processing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    üîå Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            üîå Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/transports/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transports
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/serializers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Serializers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/logging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Logging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/dead-letter-queue/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dead Letter Queue
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/message-deduplication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Message Deduplication
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/proc-handlers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Proc Handlers
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    üöö Transports
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            üöö Transports
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../memory-transport/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Memory Transport
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../redis-transport/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Redis Transport
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../redis-enhanced-transport/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Redis Enhanced Transport
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Redis Queue Transport
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Redis Queue Transport
    
  </span>
  

      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-features" class="md-nav__link">
    <span class="md-ellipsis">
      Key Features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#performance-comparison" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Comparison
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-class-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Message Class Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-configuration-options" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Configuration Options
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#async-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Async Architecture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Async Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-benefits" class="md-nav__link">
    <span class="md-ellipsis">
      Key Benefits
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage-with-async" class="md-nav__link">
    <span class="md-ellipsis">
      Usage with Async
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Async Best Practices
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#routing-keys-and-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Routing Keys and Patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Routing Keys and Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#routing-key-format" class="md-nav__link">
    <span class="md-ellipsis">
      Routing Key Format
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wildcard-patterns-rabbitmq-compatible" class="md-nav__link">
    <span class="md-ellipsis">
      Wildcard Patterns (RabbitMQ Compatible)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Pattern Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pattern-subscriptions" class="md-nav__link">
    <span class="md-ellipsis">
      Pattern Subscriptions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pattern Subscriptions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#direct-pattern-subscriptions" class="md-nav__link">
    <span class="md-ellipsis">
      Direct Pattern Subscriptions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-class-subscriptions" class="md-nav__link">
    <span class="md-ellipsis">
      Message Class Subscriptions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#convenience-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Convenience Methods
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fluent-api" class="md-nav__link">
    <span class="md-ellipsis">
      Fluent API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fluent API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-fluent-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Fluent Usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-fluent-combinations" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Fluent Combinations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-subscription-building" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic Subscription Building
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load-balancing" class="md-nav__link">
    <span class="md-ellipsis">
      Load Balancing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Load Balancing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#consumer-groups" class="md-nav__link">
    <span class="md-ellipsis">
      Consumer Groups
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load-balancing-with-fluent-api" class="md-nav__link">
    <span class="md-ellipsis">
      Load Balancing with Fluent API
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#priority-based-load-balancing" class="md-nav__link">
    <span class="md-ellipsis">
      Priority-Based Load Balancing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#message-publishing" class="md-nav__link">
    <span class="md-ellipsis">
      Message Publishing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Message Publishing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-publishing" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Publishing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#publishing-with-enhanced-headers" class="md-nav__link">
    <span class="md-ellipsis">
      Publishing with Enhanced Headers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#batch-publishing" class="md-nav__link">
    <span class="md-ellipsis">
      Batch Publishing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#queue-management" class="md-nav__link">
    <span class="md-ellipsis">
      Queue Management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Queue Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#queue-statistics" class="md-nav__link">
    <span class="md-ellipsis">
      Queue Statistics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#routing-table-inspection" class="md-nav__link">
    <span class="md-ellipsis">
      Routing Table Inspection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#queue-health-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      Queue Health Monitoring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#administrative-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Administrative Operations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling-and-reliability" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling and Reliability
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error Handling and Reliability">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#retry-mechanisms" class="md-nav__link">
    <span class="md-ellipsis">
      Retry Mechanisms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dead-letter-queue" class="md-nav__link">
    <span class="md-ellipsis">
      Dead Letter Queue
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#circuit-breaker-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      Circuit Breaker Pattern
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-cases-and-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Use Cases and Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Use Cases and Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#microservices-communication" class="md-nav__link">
    <span class="md-ellipsis">
      Microservices Communication
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-driven-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Event-Driven Architecture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-tenant-systems" class="md-nav__link">
    <span class="md-ellipsis">
      Multi-Tenant Systems
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#real-time-monitoring-and-alerting" class="md-nav__link">
    <span class="md-ellipsis">
      Real-Time Monitoring and Alerting
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#naming-conventions" class="md-nav__link">
    <span class="md-ellipsis">
      Naming Conventions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-management" class="md-nav__link">
    <span class="md-ellipsis">
      Resource Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitoring-and-observability" class="md-nav__link">
    <span class="md-ellipsis">
      Monitoring and Observability
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Optimization
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migration-from-other-transports" class="md-nav__link">
    <span class="md-ellipsis">
      Migration from Other Transports
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Migration from Other Transports">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#from-redis-pubsub" class="md-nav__link">
    <span class="md-ellipsis">
      From Redis Pub/Sub
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from-rabbitmq" class="md-nav__link">
    <span class="md-ellipsis">
      From RabbitMQ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      Troubleshooting
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#common-issues" class="md-nav__link">
    <span class="md-ellipsis">
      Common Issues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debug-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Debug Mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-debugging" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Debugging
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-reference" class="md-nav__link">
    <span class="md-ellipsis">
      API Reference
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#transport-class" class="md-nav__link">
    <span class="md-ellipsis">
      Transport Class
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fluent-api-builder" class="md-nav__link">
    <span class="md-ellipsis">
      Fluent API Builder
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-reference" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration Reference
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#transport-options" class="md-nav__link">
    <span class="md-ellipsis">
      Transport Options
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-queue-messaging" class="md-nav__link">
    <span class="md-ellipsis">
      Core Queue Messaging
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-routing-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Routing &amp; Patterns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#production-features" class="md-nav__link">
    <span class="md-ellipsis">
      Production Features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enhanced-transport-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Enhanced Transport Integration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-features-demonstrated" class="md-nav__link">
    <span class="md-ellipsis">
      Key Features Demonstrated
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Running Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Example Patterns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#production-features_1" class="md-nav__link">
    <span class="md-ellipsis">
      Production Features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#additional-resources" class="md-nav__link">
    <span class="md-ellipsis">
      Additional Resources
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      Related Documentation
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../redis-transport-comparison/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Redis Transport Comparison
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    üìö Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            üìö Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/redis-queue-getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Redis Queue Getting Started
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/redis-queue-patterns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Redis Queue Patterns
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/redis-queue-production/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Redis Queue Production
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ‚öôÔ∏è Development
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            ‚öôÔ∏è Development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/ideas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ideas & Roadmap
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-features" class="md-nav__link">
    <span class="md-ellipsis">
      Key Features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#performance-comparison" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Comparison
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-class-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Message Class Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-configuration-options" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Configuration Options
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#async-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Async Architecture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Async Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-benefits" class="md-nav__link">
    <span class="md-ellipsis">
      Key Benefits
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage-with-async" class="md-nav__link">
    <span class="md-ellipsis">
      Usage with Async
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Async Best Practices
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#routing-keys-and-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Routing Keys and Patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Routing Keys and Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#routing-key-format" class="md-nav__link">
    <span class="md-ellipsis">
      Routing Key Format
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wildcard-patterns-rabbitmq-compatible" class="md-nav__link">
    <span class="md-ellipsis">
      Wildcard Patterns (RabbitMQ Compatible)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Pattern Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pattern-subscriptions" class="md-nav__link">
    <span class="md-ellipsis">
      Pattern Subscriptions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pattern Subscriptions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#direct-pattern-subscriptions" class="md-nav__link">
    <span class="md-ellipsis">
      Direct Pattern Subscriptions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-class-subscriptions" class="md-nav__link">
    <span class="md-ellipsis">
      Message Class Subscriptions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#convenience-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Convenience Methods
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fluent-api" class="md-nav__link">
    <span class="md-ellipsis">
      Fluent API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fluent API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-fluent-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Fluent Usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-fluent-combinations" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Fluent Combinations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-subscription-building" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic Subscription Building
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load-balancing" class="md-nav__link">
    <span class="md-ellipsis">
      Load Balancing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Load Balancing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#consumer-groups" class="md-nav__link">
    <span class="md-ellipsis">
      Consumer Groups
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load-balancing-with-fluent-api" class="md-nav__link">
    <span class="md-ellipsis">
      Load Balancing with Fluent API
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#priority-based-load-balancing" class="md-nav__link">
    <span class="md-ellipsis">
      Priority-Based Load Balancing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#message-publishing" class="md-nav__link">
    <span class="md-ellipsis">
      Message Publishing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Message Publishing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-publishing" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Publishing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#publishing-with-enhanced-headers" class="md-nav__link">
    <span class="md-ellipsis">
      Publishing with Enhanced Headers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#batch-publishing" class="md-nav__link">
    <span class="md-ellipsis">
      Batch Publishing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#queue-management" class="md-nav__link">
    <span class="md-ellipsis">
      Queue Management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Queue Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#queue-statistics" class="md-nav__link">
    <span class="md-ellipsis">
      Queue Statistics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#routing-table-inspection" class="md-nav__link">
    <span class="md-ellipsis">
      Routing Table Inspection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#queue-health-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      Queue Health Monitoring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#administrative-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Administrative Operations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling-and-reliability" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling and Reliability
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error Handling and Reliability">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#retry-mechanisms" class="md-nav__link">
    <span class="md-ellipsis">
      Retry Mechanisms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dead-letter-queue" class="md-nav__link">
    <span class="md-ellipsis">
      Dead Letter Queue
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#circuit-breaker-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      Circuit Breaker Pattern
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-cases-and-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Use Cases and Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Use Cases and Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#microservices-communication" class="md-nav__link">
    <span class="md-ellipsis">
      Microservices Communication
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-driven-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Event-Driven Architecture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-tenant-systems" class="md-nav__link">
    <span class="md-ellipsis">
      Multi-Tenant Systems
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#real-time-monitoring-and-alerting" class="md-nav__link">
    <span class="md-ellipsis">
      Real-Time Monitoring and Alerting
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#naming-conventions" class="md-nav__link">
    <span class="md-ellipsis">
      Naming Conventions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-management" class="md-nav__link">
    <span class="md-ellipsis">
      Resource Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitoring-and-observability" class="md-nav__link">
    <span class="md-ellipsis">
      Monitoring and Observability
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Optimization
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migration-from-other-transports" class="md-nav__link">
    <span class="md-ellipsis">
      Migration from Other Transports
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Migration from Other Transports">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#from-redis-pubsub" class="md-nav__link">
    <span class="md-ellipsis">
      From Redis Pub/Sub
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from-rabbitmq" class="md-nav__link">
    <span class="md-ellipsis">
      From RabbitMQ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      Troubleshooting
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#common-issues" class="md-nav__link">
    <span class="md-ellipsis">
      Common Issues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debug-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Debug Mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-debugging" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Debugging
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-reference" class="md-nav__link">
    <span class="md-ellipsis">
      API Reference
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#transport-class" class="md-nav__link">
    <span class="md-ellipsis">
      Transport Class
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fluent-api-builder" class="md-nav__link">
    <span class="md-ellipsis">
      Fluent API Builder
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-reference" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration Reference
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#transport-options" class="md-nav__link">
    <span class="md-ellipsis">
      Transport Options
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-queue-messaging" class="md-nav__link">
    <span class="md-ellipsis">
      Core Queue Messaging
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-routing-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Routing &amp; Patterns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#production-features" class="md-nav__link">
    <span class="md-ellipsis">
      Production Features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enhanced-transport-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Enhanced Transport Integration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-features-demonstrated" class="md-nav__link">
    <span class="md-ellipsis">
      Key Features Demonstrated
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Running Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Example Patterns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#production-features_1" class="md-nav__link">
    <span class="md-ellipsis">
      Production Features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#additional-resources" class="md-nav__link">
    <span class="md-ellipsis">
      Additional Resources
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      Related Documentation
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/madbomber/smart_message/edit/main/docs/transports/redis-queue-transport.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/madbomber/smart_message/raw/main/docs/transports/redis-queue-transport.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="redis-queue-transport">Redis Queue Transport<a class="headerlink" href="#redis-queue-transport" title="Permanent link">&para;</a></h1>
<p>The <strong>Redis Queue Transport</strong> is SmartMessage's most advanced transport implementation, providing RabbitMQ-style queue/exchange routing using Redis Lists as persistent FIFO queues. Built on Ruby's Async framework for modern fiber-based concurrency, it combines Redis's exceptional performance with intelligent message routing capabilities.</p>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>Redis Queue Transport is perfect for:
- <strong>High-throughput applications</strong> - 100K+ messages/second with minimal latency
- <strong>Complex routing scenarios</strong> - RabbitMQ-style pattern matching with Redis performance
- <strong>Load-balanced processing</strong> - Consumer groups for horizontal scaling
- <strong>Persistent message queues</strong> - Messages survive service restarts
- <strong>Modern async applications</strong> - Built on Ruby's Async framework</p>
<h2 id="key-features">Key Features<a class="headerlink" href="#key-features" title="Permanent link">&para;</a></h2>
<ul>
<li>üöÄ <strong>RabbitMQ-Style Routing</strong> - Pattern-based subscriptions with familiar syntax</li>
<li>‚ö° <strong>Ultra-High Performance</strong> - ~0.5ms latency, 100K+ messages/second  </li>
<li>üß¨ <strong>Async/Fiber Architecture</strong> - Thousands of concurrent subscriptions</li>
<li>üîÑ <strong>Persistent Queues</strong> - Redis Lists (LPUSH/BRPOP) for message durability</li>
<li>‚öñÔ∏è <strong>Load Balancing</strong> - Consumer groups for horizontal scaling</li>
<li>üéØ <strong>Enhanced Routing</strong> - Multi-segment routing keys with from/to addressing</li>
<li>üìä <strong>Queue Monitoring</strong> - Comprehensive statistics and health monitoring</li>
<li>üõ†Ô∏è <strong>Fluent API</strong> - Chainable subscription building for complex routing</li>
</ul>
<h2 id="architecture">Architecture<a class="headerlink" href="#architecture" title="Permanent link">&para;</a></h2>
<p><img alt="Redis Queue Architecture" src="../../assets/images/redis-queue-architecture.svg" /></p>
<p>The Redis Queue Transport combines the routing intelligence of message brokers with Redis's performance characteristics. Built on Ruby's Async framework, it uses cooperative fiber-based concurrency for massive scalability with minimal resource overhead.</p>
<h3 id="performance-comparison">Performance Comparison<a class="headerlink" href="#performance-comparison" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>RabbitMQ</th>
<th>Redis Queue (Async)</th>
<th>Performance Advantage</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Latency</strong></td>
<td>~5ms</td>
<td>~0.5ms</td>
<td>Redis <strong>10x faster</strong></td>
</tr>
<tr>
<td><strong>Throughput</strong></td>
<td>20K-30K msg/sec</td>
<td>100K+ msg/sec</td>
<td>Redis <strong>3-5x faster</strong></td>
</tr>
<tr>
<td><strong>Concurrent Subscribers</strong></td>
<td>~100s</td>
<td>~1000s</td>
<td>Async <strong>10x more</strong></td>
</tr>
<tr>
<td><strong>Memory per Connection</strong></td>
<td>~2MB</td>
<td>~2KB</td>
<td>Async <strong>1000x less</strong></td>
</tr>
<tr>
<td><strong>Pattern Matching</strong></td>
<td>Server-side</td>
<td>Client-side</td>
<td>Same syntax</td>
</tr>
<tr>
<td><strong>Load Balancing</strong></td>
<td>Queue groups</td>
<td>Consumer groups</td>
<td>Same behavior</td>
</tr>
<tr>
<td><strong>Setup Complexity</strong></td>
<td>High</td>
<td>Low</td>
<td>Redis <strong>simpler</strong></td>
</tr>
</tbody>
</table>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h2>
<h3 id="basic-configuration">Basic Configuration<a class="headerlink" href="#basic-configuration" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="no">SmartMessage</span><span class="o">.</span><span class="n">configure</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">  </span><span class="n">config</span><span class="o">.</span><span class="n">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:redis_queue</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">  </span><span class="n">config</span><span class="o">.</span><span class="n">transport_options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">    </span><span class="ss">url</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;redis://localhost:6379&#39;</span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">    </span><span class="ss">db</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">    </span><span class="ss">queue_prefix</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;smart_message.queue&#39;</span><span class="p">,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">    </span><span class="ss">consumer_group</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;default_workers&#39;</span><span class="p">,</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">    </span><span class="ss">block_time</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w">  </span><span class="c1"># 1 second blocking read</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">    </span><span class="ss">max_queue_length</span><span class="p">:</span><span class="w"> </span><span class="mi">10000</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="k">end</span>
</span></code></pre></div>
<h3 id="message-class-configuration">Message Class Configuration<a class="headerlink" href="#message-class-configuration" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">OrderMessage</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="no">SmartMessage</span><span class="o">::</span><span class="no">Base</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">  </span><span class="n">transport</span><span class="w"> </span><span class="ss">:redis_queue</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="ss">url</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;redis://redis-server:6379&#39;</span><span class="p">,</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="ss">consumer_group</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;order_processors&#39;</span><span class="p">,</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">    </span><span class="ss">queue_prefix</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;orders&#39;</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">  </span><span class="n">property</span><span class="w"> </span><span class="ss">:order_id</span><span class="p">,</span><span class="w"> </span><span class="ss">required</span><span class="p">:</span><span class="w"> </span><span class="kp">true</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">  </span><span class="n">property</span><span class="w"> </span><span class="ss">:amount</span><span class="p">,</span><span class="w"> </span><span class="ss">required</span><span class="p">:</span><span class="w"> </span><span class="kp">true</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">process</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">    </span><span class="c1"># Process order logic</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">    </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Processing order </span><span class="si">#{</span><span class="n">order_id</span><span class="si">}</span><span class="s2"> for $</span><span class="si">#{</span><span class="n">amount</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="k">end</span>
</span></code></pre></div>
<h3 id="advanced-configuration-options">Advanced Configuration Options<a class="headerlink" href="#advanced-configuration-options" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">SmartMessage</span><span class="o">::</span><span class="no">Transport</span><span class="o">::</span><span class="no">RedisQueueTransport</span><span class="o">.</span><span class="n">new</span><span class="p">({</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">  </span><span class="c1"># Connection settings</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">  </span><span class="ss">url</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;redis://username:password@redis.example.com:6379&#39;</span><span class="p">,</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">  </span><span class="ss">db</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">  </span><span class="c1"># Queue settings</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">  </span><span class="ss">queue_prefix</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;myapp.queues&#39;</span><span class="p">,</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">  </span><span class="ss">consumer_group</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;myapp_workers&#39;</span><span class="p">,</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">  </span><span class="ss">consumer_id</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">#{</span><span class="no">Socket</span><span class="o">.</span><span class="n">gethostname</span><span class="si">}</span><span class="s2">_</span><span class="si">#{</span><span class="no">Process</span><span class="o">.</span><span class="n">pid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">  </span><span class="c1"># Performance tuning</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">  </span><span class="ss">block_time</span><span class="p">:</span><span class="w"> </span><span class="mi">5000</span><span class="p">,</span><span class="w">         </span><span class="c1"># 5 second blocking timeout</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="w">  </span><span class="ss">max_queue_length</span><span class="p">:</span><span class="w"> </span><span class="mi">50000</span><span class="p">,</span><span class="w">  </span><span class="c1"># Trim queues at 50k messages</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">  </span><span class="ss">batch_size</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">           </span><span class="c1"># Process messages in batches</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="w">  </span><span class="c1"># Reliability settings</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="w">  </span><span class="ss">max_retries</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="w">  </span><span class="ss">retry_delay</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">           </span><span class="c1"># 5 seconds between retries</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="w">  </span><span class="ss">dead_letter_queue</span><span class="p">:</span><span class="w"> </span><span class="kp">true</span><span class="p">,</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="w">  </span><span class="c1"># Connection pooling</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a><span class="w">  </span><span class="ss">pool_size</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="w">  </span><span class="ss">pool_timeout</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="p">})</span>
</span></code></pre></div>
<h2 id="async-architecture">Async Architecture<a class="headerlink" href="#async-architecture" title="Permanent link">&para;</a></h2>
<p>The Redis Queue Transport is built on Ruby's <strong>Async framework</strong>, providing modern fiber-based concurrency that offers significant advantages over traditional thread-based approaches:</p>
<h3 id="key-benefits">Key Benefits<a class="headerlink" href="#key-benefits" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Massive Scalability</strong>: Support for thousands of concurrent subscribers with minimal resource overhead</li>
<li><strong>Cooperative Concurrency</strong>: Fibers yield control voluntarily, eliminating race conditions and reducing context switching overhead  </li>
<li><strong>Memory Efficiency</strong>: Each fiber uses ~2KB vs ~2MB per thread (1000x less memory)</li>
<li><strong>Test-Friendly</strong>: Clean async lifecycle management with proper shutdown and cleanup</li>
<li><strong>Non-Blocking I/O</strong>: All Redis operations are fully asynchronous and non-blocking</li>
</ul>
<h3 id="usage-with-async">Usage with Async<a class="headerlink" href="#usage-with-async" title="Permanent link">&para;</a></h3>
<p>All transport operations should be wrapped in <code>Async</code> blocks for optimal performance:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1"># Basic async usage</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="no">Async</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">  </span><span class="n">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">SmartMessage</span><span class="o">::</span><span class="no">Transport</span><span class="o">::</span><span class="no">RedisQueueTransport</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span><span class="ss">url</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;redis://localhost:6379&#39;</span><span class="p">,</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">    </span><span class="ss">db</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">    </span><span class="ss">test_mode</span><span class="p">:</span><span class="w"> </span><span class="kp">false</span><span class="w">  </span><span class="c1"># Enable consumer tasks</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">  </span><span class="c1"># Subscribe to patterns</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">  </span><span class="n">transport</span><span class="o">.</span><span class="n">subscribe_pattern</span><span class="p">(</span><span class="s2">&quot;#.*.my_service&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">message_class</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">|</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">    </span><span class="c1"># Process messages in async fiber</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">    </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Processing </span><span class="si">#{</span><span class="n">message_class</span><span class="si">}</span><span class="s2"> in fiber </span><span class="si">#{</span><span class="no">Async</span><span class="o">::</span><span class="no">Task</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">object_id</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="w">  </span><span class="c1"># Publish messages</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="w">  </span><span class="no">MyMessage</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">data</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">publish</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="w">  </span><span class="c1"># Keep async context alive</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="w">  </span><span class="nb">sleep</span>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="k">end</span>
</span></code></pre></div>
<h3 id="async-best-practices">Async Best Practices<a class="headerlink" href="#async-best-practices" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># Multiple concurrent subscriptions</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="no">Async</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">task</span><span class="o">|</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">  </span><span class="n">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">SmartMessage</span><span class="o">::</span><span class="no">Transport</span><span class="o">::</span><span class="no">RedisQueueTransport</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">  </span><span class="c1"># Each subscription runs in its own fiber</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">  </span><span class="n">task</span><span class="o">.</span><span class="n">async</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">    </span><span class="n">transport</span><span class="o">.</span><span class="n">subscribe_pattern</span><span class="p">(</span><span class="s2">&quot;#.*.service1&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">|</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">|</span><span class="w"> </span><span class="o">...</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">  </span><span class="n">task</span><span class="o">.</span><span class="n">async</span><span class="w"> </span><span class="k">do</span><span class="w">  </span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">    </span><span class="n">transport</span><span class="o">.</span><span class="n">subscribe_pattern</span><span class="p">(</span><span class="s2">&quot;#.*.service2&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">|</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">|</span><span class="w"> </span><span class="o">...</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w">  </span><span class="n">task</span><span class="o">.</span><span class="n">async</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="w">    </span><span class="n">transport</span><span class="o">.</span><span class="n">subscribe_pattern</span><span class="p">(</span><span class="s2">&quot;#.*.service3&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">|</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">|</span><span class="w"> </span><span class="o">...</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="w">  </span><span class="c1"># All subscriptions run concurrently with minimal overhead</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="w">  </span><span class="nb">sleep</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="k">end</span>
</span></code></pre></div>
<h2 id="routing-keys-and-patterns">Routing Keys and Patterns<a class="headerlink" href="#routing-keys-and-patterns" title="Permanent link">&para;</a></h2>
<h3 id="routing-key-format">Routing Key Format<a class="headerlink" href="#routing-key-format" title="Permanent link">&para;</a></h3>
<p>Messages are published with enhanced routing keys in the format:
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>namespace.message_type.from_uuid.to_uuid
</span></code></pre></div></p>
<p>Examples:
- <code>order.ordermessage.user123.service456</code>
- <code>emergency.alertmessage.security.broadcast</code><br />
- <code>system.healthcheck.monitor.all_services</code></p>
<h3 id="wildcard-patterns-rabbitmq-compatible">Wildcard Patterns (RabbitMQ Compatible)<a class="headerlink" href="#wildcard-patterns-rabbitmq-compatible" title="Permanent link">&para;</a></h3>
<p>The Redis Queue Transport uses identical wildcard syntax to RabbitMQ:</p>
<ul>
<li><strong><code>#</code></strong> = Zero or more words (matches <code>a</code>, <code>a.b</code>, <code>a.b.c</code>)  </li>
<li><strong><code>*</code></strong> = Exactly one word (matches <code>a</code> but not <code>a.b</code>)</li>
<li><strong><code>.</code></strong> = Word separator (literal dot)</li>
</ul>
<h3 id="pattern-examples">Pattern Examples<a class="headerlink" href="#pattern-examples" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1"># Recipient-based routing</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="n">transport</span><span class="o">.</span><span class="n">subscribe_pattern</span><span class="p">(</span><span class="s2">&quot;#.*.payment_service&quot;</span><span class="p">)</span><span class="w">      </span><span class="c1"># All TO payment_service</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="n">transport</span><span class="o">.</span><span class="n">subscribe_pattern</span><span class="p">(</span><span class="s2">&quot;#.*.user_</span><span class="si">#{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="w">      </span><span class="c1"># Personal messages</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="c1"># Sender-based routing  </span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="n">transport</span><span class="o">.</span><span class="n">subscribe_pattern</span><span class="p">(</span><span class="s2">&quot;#.admin_service.*&quot;</span><span class="p">)</span><span class="w">        </span><span class="c1"># All FROM admin_service</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="n">transport</span><span class="o">.</span><span class="n">subscribe_pattern</span><span class="p">(</span><span class="s2">&quot;#.</span><span class="si">#{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">.*&quot;</span><span class="p">)</span><span class="w">      </span><span class="c1"># All from your service</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="c1"># Message type routing</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="n">transport</span><span class="o">.</span><span class="n">subscribe_pattern</span><span class="p">(</span><span class="s2">&quot;order.#.*.*&quot;</span><span class="p">)</span><span class="w">              </span><span class="c1"># All order messages</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="n">transport</span><span class="o">.</span><span class="n">subscribe_pattern</span><span class="p">(</span><span class="s2">&quot;alert.#.*.*&quot;</span><span class="p">)</span><span class="w">              </span><span class="c1"># All alerts</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="n">transport</span><span class="o">.</span><span class="n">subscribe_pattern</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">namespace</span><span class="si">}</span><span class="s2">.#.*.*&quot;</span><span class="p">)</span><span class="w">       </span><span class="c1"># All in namespace</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="c1"># Complex routing</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="n">transport</span><span class="o">.</span><span class="n">subscribe_pattern</span><span class="p">(</span><span class="s2">&quot;emergency.#.security.*&quot;</span><span class="p">)</span><span class="w">   </span><span class="c1"># Security emergencies</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="n">transport</span><span class="o">.</span><span class="n">subscribe_pattern</span><span class="p">(</span><span class="s2">&quot;#.*.</span><span class="si">#{</span><span class="n">env</span><span class="si">}</span><span class="s2">_services&quot;</span><span class="p">)</span><span class="w">      </span><span class="c1"># Environment-specific</span>
</span></code></pre></div>
<h2 id="pattern-subscriptions">Pattern Subscriptions<a class="headerlink" href="#pattern-subscriptions" title="Permanent link">&para;</a></h2>
<h3 id="direct-pattern-subscriptions">Direct Pattern Subscriptions<a class="headerlink" href="#direct-pattern-subscriptions" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1"># Create transport instance</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="n">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">SmartMessage</span><span class="o">::</span><span class="no">Transport</span><span class="o">::</span><span class="no">RedisQueueTransport</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="c1"># Subscribe to messages TO specific services</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="n">transport</span><span class="o">.</span><span class="n">subscribe_pattern</span><span class="p">(</span><span class="s2">&quot;#.*.payment_service&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">message_class</span><span class="p">,</span><span class="w"> </span><span class="n">message_data</span><span class="o">|</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">  </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Payment service received: </span><span class="si">#{</span><span class="n">message_class</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">  </span><span class="c1"># Process payment message</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="k">end</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="c1"># Subscribe to messages FROM specific services</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="n">transport</span><span class="o">.</span><span class="n">subscribe_pattern</span><span class="p">(</span><span class="s2">&quot;#.admin_service.*&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">message_class</span><span class="p">,</span><span class="w"> </span><span class="n">message_data</span><span class="o">|</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="w">  </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Message from admin: </span><span class="si">#{</span><span class="n">message_class</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="w">  </span><span class="c1"># Process admin message</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="k">end</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="c1"># Subscribe to specific message types</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="n">transport</span><span class="o">.</span><span class="n">subscribe_pattern</span><span class="p">(</span><span class="s2">&quot;order.#.*.*&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">message_class</span><span class="p">,</span><span class="w"> </span><span class="n">message_data</span><span class="o">|</span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="w">  </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Order message received: </span><span class="si">#{</span><span class="n">message_class</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a><span class="w">  </span><span class="c1"># Process any order message</span>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a><span class="k">end</span>
</span></code></pre></div>
<h3 id="message-class-subscriptions">Message Class Subscriptions<a class="headerlink" href="#message-class-subscriptions" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1"># Standard SmartMessage subscription (auto-generates patterns)</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">OrderMessage</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="no">SmartMessage</span><span class="o">::</span><span class="no">Base</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">  </span><span class="n">transport</span><span class="w"> </span><span class="ss">:redis_queue</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">  </span><span class="c1"># This automatically subscribes to pattern: &quot;order.ordermessage.*.*&quot;</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="k">end</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="no">OrderMessage</span><span class="o">.</span><span class="n">subscribe</span><span class="w">  </span><span class="c1"># Subscribes to all OrderMessage instances</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="c1"># Custom pattern subscription for message class</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="no">OrderMessage</span><span class="o">.</span><span class="n">subscribe_pattern</span><span class="p">(</span><span class="s2">&quot;#.*.order_service&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">message</span><span class="o">|</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w">  </span><span class="c1"># Only process orders directed to order_service</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="k">end</span>
</span></code></pre></div>
<h2 id="convenience-methods">Convenience Methods<a class="headerlink" href="#convenience-methods" title="Permanent link">&para;</a></h2>
<p>The transport provides convenient methods for common routing patterns:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1"># Simple recipient/sender filtering</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="n">transport</span><span class="o">.</span><span class="n">subscribe_to_recipient</span><span class="p">(</span><span class="s1">&#39;my_service&#39;</span><span class="p">)</span><span class="w">          </span><span class="c1"># Messages TO me</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="n">transport</span><span class="o">.</span><span class="n">subscribe_from_sender</span><span class="p">(</span><span class="s1">&#39;payment_service&#39;</span><span class="p">)</span><span class="w">      </span><span class="c1"># Messages FROM payment</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="n">transport</span><span class="o">.</span><span class="n">subscribe_to_type</span><span class="p">(</span><span class="s1">&#39;OrderMessage&#39;</span><span class="p">)</span><span class="w">             </span><span class="c1"># All OrderMessage types</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="c1"># Broadcast and alert patterns</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="n">transport</span><span class="o">.</span><span class="n">subscribe_to_broadcasts</span><span class="w">                        </span><span class="c1"># All broadcast messages</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="n">transport</span><span class="o">.</span><span class="n">subscribe_to_alerts</span><span class="w">                           </span><span class="c1"># Emergency/alert messages</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="c1"># Environment-based subscriptions</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="n">transport</span><span class="o">.</span><span class="n">subscribe_to_environment</span><span class="p">(</span><span class="s1">&#39;production&#39;</span><span class="p">)</span><span class="w">        </span><span class="c1"># Only prod messages</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="n">transport</span><span class="o">.</span><span class="n">subscribe_to_tenant</span><span class="p">(</span><span class="s1">&#39;tenant_123&#39;</span><span class="p">)</span><span class="w">             </span><span class="c1"># Tenant-specific messages</span>
</span></code></pre></div>
<h2 id="fluent-api">Fluent API<a class="headerlink" href="#fluent-api" title="Permanent link">&para;</a></h2>
<p>The fluent API provides an expressive way to build complex subscriptions:</p>
<h3 id="basic-fluent-usage">Basic Fluent Usage<a class="headerlink" href="#basic-fluent-usage" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># Simple FROM subscription</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="n">transport</span><span class="o">.</span><span class="n">where</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">  </span><span class="o">.</span><span class="n">from</span><span class="p">(</span><span class="s1">&#39;api_service&#39;</span><span class="p">)</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">  </span><span class="o">.</span><span class="n">subscribe</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">message_class</span><span class="p">,</span><span class="w"> </span><span class="n">message_data</span><span class="o">|</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">    </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Message from API service: </span><span class="si">#{</span><span class="n">message_class</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="c1"># Simple TO subscription</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="n">transport</span><span class="o">.</span><span class="n">where</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">  </span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;task_processor&#39;</span><span class="p">)</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">  </span><span class="o">.</span><span class="n">subscribe</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">message_class</span><span class="p">,</span><span class="w"> </span><span class="n">message_data</span><span class="o">|</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="w">    </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Task for processor: </span><span class="si">#{</span><span class="n">message_class</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="c1"># Type-specific subscription</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="n">transport</span><span class="o">.</span><span class="n">where</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="w">  </span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="s1">&#39;TaskMessage&#39;</span><span class="p">)</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a><span class="w">  </span><span class="o">.</span><span class="n">subscribe</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">message_class</span><span class="p">,</span><span class="w"> </span><span class="n">message_data</span><span class="o">|</span>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a><span class="w">    </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Task message received: </span><span class="si">#{</span><span class="n">message_class</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a><span class="w">  </span><span class="k">end</span>
</span></code></pre></div>
<h3 id="advanced-fluent-combinations">Advanced Fluent Combinations<a class="headerlink" href="#advanced-fluent-combinations" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1"># Combined FROM and TO</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="n">transport</span><span class="o">.</span><span class="n">where</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">  </span><span class="o">.</span><span class="n">from</span><span class="p">(</span><span class="s1">&#39;web_app&#39;</span><span class="p">)</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">  </span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;event_processor&#39;</span><span class="p">)</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">  </span><span class="o">.</span><span class="n">subscribe</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">message_class</span><span class="p">,</span><span class="w"> </span><span class="n">message_data</span><span class="o">|</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">    </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Web app event: </span><span class="si">#{</span><span class="n">message_class</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="c1"># Consumer group with load balancing</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="n">transport</span><span class="o">.</span><span class="n">where</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="w">  </span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="s1">&#39;TaskMessage&#39;</span><span class="p">)</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="w">  </span><span class="o">.</span><span class="n">consumer_group</span><span class="p">(</span><span class="s1">&#39;task_workers&#39;</span><span class="p">)</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="w">  </span><span class="o">.</span><span class="n">subscribe</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">message_class</span><span class="p">,</span><span class="w"> </span><span class="n">message_data</span><span class="o">|</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="w">    </span><span class="n">fiber_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">Async</span><span class="o">::</span><span class="no">Task</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">object_id</span><span class="o">.</span><span class="n">to_s</span><span class="o">[-</span><span class="mi">4</span><span class="o">..-</span><span class="mi">1</span><span class="o">]</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="w">    </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Fiber-</span><span class="si">#{</span><span class="n">fiber_id</span><span class="si">}</span><span class="s2"> processing: </span><span class="si">#{</span><span class="n">message_class</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a><span class="c1"># Complex multi-criteria subscription</span>
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a><span class="n">transport</span><span class="o">.</span><span class="n">where</span>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a><span class="w">  </span><span class="o">.</span><span class="n">from</span><span class="p">(</span><span class="sr">/^admin_.*/</span><span class="p">)</span><span class="w">  </span><span class="c1"># Regex pattern for admin services</span>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a><span class="w">  </span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;monitoring_service&#39;</span><span class="p">)</span>
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a><span class="w">  </span><span class="o">.</span><span class="n">consumer_group</span><span class="p">(</span><span class="s1">&#39;monitoring_workers&#39;</span><span class="p">)</span>
</span><span id="__span-11-23"><a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a><span class="w">  </span><span class="o">.</span><span class="n">subscribe</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">message_class</span><span class="p">,</span><span class="w"> </span><span class="n">message_data</span><span class="o">|</span>
</span><span id="__span-11-24"><a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a><span class="w">    </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Admin monitoring: </span><span class="si">#{</span><span class="n">message_class</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-11-25"><a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-11-26"><a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a>
</span><span id="__span-11-27"><a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a><span class="c1"># Type and destination combination</span>
</span><span id="__span-11-28"><a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a><span class="n">transport</span><span class="o">.</span><span class="n">where</span>
</span><span id="__span-11-29"><a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a><span class="w">  </span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="s1">&#39;EventMessage&#39;</span><span class="p">)</span>
</span><span id="__span-11-30"><a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a><span class="w">  </span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="sr">/.*analytics.*/</span><span class="p">)</span><span class="w">  </span><span class="c1"># Any service with &#39;analytics&#39; in name</span>
</span><span id="__span-11-31"><a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a><span class="w">  </span><span class="o">.</span><span class="n">subscribe</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">message_class</span><span class="p">,</span><span class="w"> </span><span class="n">message_data</span><span class="o">|</span>
</span><span id="__span-11-32"><a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a><span class="w">    </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Analytics event: </span><span class="si">#{</span><span class="n">message_class</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-11-33"><a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a><span class="w">  </span><span class="k">end</span>
</span></code></pre></div>
<h3 id="dynamic-subscription-building">Dynamic Subscription Building<a class="headerlink" href="#dynamic-subscription-building" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1"># Build and modify subscriptions dynamically</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="n">base_subscription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">transport</span><span class="o">.</span><span class="n">where</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="s1">&#39;TaskMessage&#39;</span><span class="p">)</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="c1"># Add criteria dynamically</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="n">urgent_tasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">base_subscription</span><span class="o">.</span><span class="n">from</span><span class="p">(</span><span class="s1">&#39;urgent_processor&#39;</span><span class="p">)</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="n">pattern1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">urgent_tasks</span><span class="o">.</span><span class="n">build</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Urgent tasks pattern: </span><span class="si">#{</span><span class="n">pattern1</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="c1"># Build different variations</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="n">analytics_tasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">base_subscription</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="sr">/.*analytics.*/</span><span class="p">)</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="n">pattern2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analytics_tasks</span><span class="o">.</span><span class="n">build</span><span class="w">  </span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Analytics tasks pattern: </span><span class="si">#{</span><span class="n">pattern2</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="c1"># Subscribe with complex pattern</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="n">transport</span><span class="o">.</span><span class="n">where</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="w">  </span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="s1">&#39;EventMessage&#39;</span><span class="p">)</span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a><span class="w">  </span><span class="o">.</span><span class="n">from</span><span class="p">(</span><span class="sr">/^(web|mobile)_app$/</span><span class="p">)</span><span class="w">  </span><span class="c1"># From web or mobile app</span>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a><span class="w">  </span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="sr">/.*analytics.*/</span><span class="p">)</span><span class="w">         </span><span class="c1"># To any analytics service</span>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a><span class="w">  </span><span class="o">.</span><span class="n">consumer_group</span><span class="p">(</span><span class="s1">&#39;analytics_processors&#39;</span><span class="p">)</span>
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a><span class="w">  </span><span class="o">.</span><span class="n">subscribe</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">message_class</span><span class="p">,</span><span class="w"> </span><span class="n">message_data</span><span class="o">|</span>
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a><span class="w">    </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Complex pattern match: </span><span class="si">#{</span><span class="n">message_class</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a><span class="w">  </span><span class="k">end</span>
</span></code></pre></div>
<h2 id="load-balancing">Load Balancing<a class="headerlink" href="#load-balancing" title="Permanent link">&para;</a></h2>
<h3 id="consumer-groups">Consumer Groups<a class="headerlink" href="#consumer-groups" title="Permanent link">&para;</a></h3>
<p>Multiple consumers can share the same queue for automatic load distribution:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1"># Create multiple workers in the same consumer group</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="n">worker1_transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">SmartMessage</span><span class="o">::</span><span class="no">Transport</span><span class="o">::</span><span class="no">RedisQueueTransport</span><span class="o">.</span><span class="n">new</span><span class="p">({</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">  </span><span class="ss">consumer_group</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;order_workers&#39;</span><span class="p">,</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">  </span><span class="ss">consumer_id</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;worker_1&#39;</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="p">})</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="n">worker2_transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">SmartMessage</span><span class="o">::</span><span class="no">Transport</span><span class="o">::</span><span class="no">RedisQueueTransport</span><span class="o">.</span><span class="n">new</span><span class="p">({</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="w">  </span><span class="ss">consumer_group</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;order_workers&#39;</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="w">  </span><span class="ss">consumer_id</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;worker_2&#39;</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="p">})</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="n">worker3_transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">SmartMessage</span><span class="o">::</span><span class="no">Transport</span><span class="o">::</span><span class="no">RedisQueueTransport</span><span class="o">.</span><span class="n">new</span><span class="p">({</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="w">  </span><span class="ss">consumer_group</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;order_workers&#39;</span><span class="p">,</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a><span class="w">  </span><span class="ss">consumer_id</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;worker_3&#39;</span>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="p">})</span>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a><span class="c1"># All workers subscribe to same pattern</span>
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;#.*.order_service&quot;</span>
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>
</span><span id="__span-13-20"><a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a><span class="n">worker1_transport</span><span class="o">.</span><span class="n">subscribe_pattern</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">|</span><span class="n">msg</span><span class="o">|</span><span class="w"> </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Worker 1: </span><span class="si">#{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-13-21"><a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a><span class="n">worker2_transport</span><span class="o">.</span><span class="n">subscribe_pattern</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">|</span><span class="n">msg</span><span class="o">|</span><span class="w"> </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Worker 2: </span><span class="si">#{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-13-22"><a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a><span class="n">worker3_transport</span><span class="o">.</span><span class="n">subscribe_pattern</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">|</span><span class="n">msg</span><span class="o">|</span><span class="w"> </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Worker 3: </span><span class="si">#{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-13-23"><a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a>
</span><span id="__span-13-24"><a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a><span class="c1"># Messages published to order_service will be distributed among workers</span>
</span></code></pre></div>
<h3 id="load-balancing-with-fluent-api">Load Balancing with Fluent API<a class="headerlink" href="#load-balancing-with-fluent-api" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1"># Multiple workers using fluent API</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="mi">3</span><span class="o">.</span><span class="n">times</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">  </span><span class="n">worker_transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">SmartMessage</span><span class="o">::</span><span class="no">Transport</span><span class="o">::</span><span class="no">RedisQueueTransport</span><span class="o">.</span><span class="n">new</span><span class="p">({</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">    </span><span class="ss">consumer_group</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;balanced_workers&#39;</span><span class="p">,</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w">    </span><span class="ss">consumer_id</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;worker_</span><span class="si">#{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">  </span><span class="p">})</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="w">  </span><span class="n">worker_transport</span><span class="o">.</span><span class="n">where</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="w">    </span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;shared_service&#39;</span><span class="p">)</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="w">    </span><span class="o">.</span><span class="n">consumer_group</span><span class="p">(</span><span class="s1">&#39;balanced_workers&#39;</span><span class="p">)</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="w">    </span><span class="o">.</span><span class="n">subscribe</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">message_class</span><span class="p">,</span><span class="w"> </span><span class="n">message_data</span><span class="o">|</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="w">      </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Worker </span><span class="si">#{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> processing: </span><span class="si">#{</span><span class="n">message_class</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="k">end</span>
</span></code></pre></div>
<h3 id="priority-based-load-balancing">Priority-Based Load Balancing<a class="headerlink" href="#priority-based-load-balancing" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1"># High-priority worker pool</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="n">high_priority_transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">SmartMessage</span><span class="o">::</span><span class="no">Transport</span><span class="o">::</span><span class="no">RedisQueueTransport</span><span class="o">.</span><span class="n">new</span><span class="p">({</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">  </span><span class="ss">consumer_group</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;high_priority_workers&#39;</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="p">})</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="n">high_priority_transport</span><span class="o">.</span><span class="n">where</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="w">  </span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;priority_queue&#39;</span><span class="p">)</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="w">  </span><span class="o">.</span><span class="n">consumer_group</span><span class="p">(</span><span class="s1">&#39;high_priority_workers&#39;</span><span class="p">)</span><span class="w">  </span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="w">  </span><span class="o">.</span><span class="n">subscribe</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">message_class</span><span class="p">,</span><span class="w"> </span><span class="n">message_data</span><span class="o">|</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="w">    </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;HIGH PRIORITY: </span><span class="si">#{</span><span class="n">message_class</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="c1"># Normal priority worker pool  </span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="n">normal_priority_transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">SmartMessage</span><span class="o">::</span><span class="no">Transport</span><span class="o">::</span><span class="no">RedisQueueTransport</span><span class="o">.</span><span class="n">new</span><span class="p">({</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="w">  </span><span class="ss">consumer_group</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;normal_workers&#39;</span>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="p">})</span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="n">normal_priority_transport</span><span class="o">.</span><span class="n">where</span>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="w">  </span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;normal_queue&#39;</span><span class="p">)</span>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="w">  </span><span class="o">.</span><span class="n">consumer_group</span><span class="p">(</span><span class="s1">&#39;normal_workers&#39;</span><span class="p">)</span>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="w">  </span><span class="o">.</span><span class="n">subscribe</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">message_class</span><span class="p">,</span><span class="w"> </span><span class="n">message_data</span><span class="o">|</span>
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="w">    </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Normal priority: </span><span class="si">#{</span><span class="n">message_class</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="w">  </span><span class="k">end</span>
</span></code></pre></div>
<h2 id="message-publishing">Message Publishing<a class="headerlink" href="#message-publishing" title="Permanent link">&para;</a></h2>
<h3 id="basic-publishing">Basic Publishing<a class="headerlink" href="#basic-publishing" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">OrderMessage</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="no">SmartMessage</span><span class="o">::</span><span class="no">Base</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">  </span><span class="n">transport</span><span class="w"> </span><span class="ss">:redis_queue</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">  </span><span class="n">property</span><span class="w"> </span><span class="ss">:order_id</span><span class="p">,</span><span class="w"> </span><span class="ss">required</span><span class="p">:</span><span class="w"> </span><span class="kp">true</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">  </span><span class="n">property</span><span class="w"> </span><span class="ss">:customer_id</span><span class="p">,</span><span class="w"> </span><span class="ss">required</span><span class="p">:</span><span class="w"> </span><span class="kp">true</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">  </span><span class="n">property</span><span class="w"> </span><span class="ss">:amount</span><span class="p">,</span><span class="w"> </span><span class="ss">required</span><span class="p">:</span><span class="w"> </span><span class="kp">true</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="k">end</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="c1"># Publish with automatic routing</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">OrderMessage</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="w">  </span><span class="ss">order_id</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;ORD-001&#39;</span><span class="p">,</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="w">  </span><span class="ss">customer_id</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;CUST-123&#39;</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="w">  </span><span class="ss">amount</span><span class="p">:</span><span class="w"> </span><span class="mi">99</span><span class="o">.</span><span class="mi">99</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="p">)</span>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="c1"># Set routing header for enhanced routing</span>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="n">message</span><span class="o">.</span><span class="n">_sm_header</span><span class="o">.</span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;order_service&#39;</span>
</span><span id="__span-16-18"><a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a><span class="n">message</span><span class="o">.</span><span class="n">_sm_header</span><span class="o">.</span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;payment_service&#39;</span>
</span><span id="__span-16-19"><a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a>
</span><span id="__span-16-20"><a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a><span class="n">message</span><span class="o">.</span><span class="n">publish</span><span class="w">  </span><span class="c1"># Routes to: order.ordermessage.order_service.payment_service</span>
</span></code></pre></div>
<h3 id="publishing-with-enhanced-headers">Publishing with Enhanced Headers<a class="headerlink" href="#publishing-with-enhanced-headers" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1"># Explicit header setting</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="no">OrderMessage</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">  </span><span class="ss">order_id</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;ORD-002&#39;</span><span class="p">,</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">  </span><span class="ss">customer_id</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;CUST-456&#39;</span><span class="p">,</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">  </span><span class="ss">amount</span><span class="p">:</span><span class="w"> </span><span class="mi">149</span><span class="o">.</span><span class="mi">99</span><span class="p">,</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">  </span><span class="ss">_sm_header</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">    </span><span class="ss">from</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;api_gateway&#39;</span><span class="p">,</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="w">    </span><span class="ss">to</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;order_service&#39;</span><span class="p">,</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="w">    </span><span class="ss">correlation_id</span><span class="p">:</span><span class="w"> </span><span class="no">SecureRandom</span><span class="o">.</span><span class="n">uuid</span><span class="p">,</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="w">    </span><span class="ss">tenant_id</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;tenant_123&#39;</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="p">)</span><span class="o">.</span><span class="n">publish</span>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="c1"># Broadcast publishing</span>
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="no">AlertMessage</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a><span class="w">  </span><span class="ss">alert_type</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;maintenance&#39;</span><span class="p">,</span>
</span><span id="__span-17-17"><a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a><span class="w">  </span><span class="ss">message</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;System maintenance starting in 10 minutes&#39;</span><span class="p">,</span>
</span><span id="__span-17-18"><a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a><span class="w">  </span><span class="ss">_sm_header</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-19"><a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a><span class="w">    </span><span class="ss">from</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;admin_service&#39;</span><span class="p">,</span>
</span><span id="__span-17-20"><a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a><span class="w">    </span><span class="ss">to</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;broadcast&#39;</span><span class="w">  </span><span class="c1"># Routes to all subscribers of broadcasts</span>
</span><span id="__span-17-21"><a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-17-22"><a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a><span class="p">)</span><span class="o">.</span><span class="n">publish</span>
</span><span id="__span-17-23"><a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a>
</span><span id="__span-17-24"><a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a><span class="c1"># Environment-specific publishing</span>
</span><span id="__span-17-25"><a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a><span class="no">DeploymentMessage</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
</span><span id="__span-17-26"><a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a><span class="w">  </span><span class="ss">version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;2.1.0&#39;</span><span class="p">,</span>
</span><span id="__span-17-27"><a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a><span class="w">  </span><span class="ss">changelog</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;Bug fixes and performance improvements&#39;</span><span class="p">,</span>
</span><span id="__span-17-28"><a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a><span class="w">  </span><span class="ss">_sm_header</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-29"><a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a><span class="w">    </span><span class="ss">from</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;ci_cd_service&#39;</span><span class="p">,</span>
</span><span id="__span-17-30"><a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a><span class="w">    </span><span class="ss">to</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;prod_services&#39;</span><span class="w">  </span><span class="c1"># Only production services</span>
</span><span id="__span-17-31"><a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-17-32"><a id="__codelineno-17-32" name="__codelineno-17-32" href="#__codelineno-17-32"></a><span class="p">)</span><span class="o">.</span><span class="n">publish</span>
</span></code></pre></div>
<h3 id="batch-publishing">Batch Publishing<a class="headerlink" href="#batch-publishing" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1"># Publish multiple messages efficiently</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="n">messages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[]</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="mi">100</span><span class="o">.</span><span class="n">times</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">  </span><span class="n">messages</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="no">TaskMessage</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="w">    </span><span class="ss">task_id</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;BATCH-</span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="w">    </span><span class="ss">priority</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;normal&#39;</span><span class="p">,</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="w">    </span><span class="ss">_sm_header</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="w">      </span><span class="ss">from</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;batch_processor&#39;</span><span class="p">,</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="w">      </span><span class="ss">to</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;worker_pool&#39;</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="w">  </span><span class="p">)</span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="k">end</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a><span class="c1"># Batch publish for better performance</span>
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a><span class="n">messages</span><span class="o">.</span><span class="n">each</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:publish</span><span class="p">)</span><span class="w">  </span><span class="c1"># Redis pipelining automatically optimizes this</span>
</span></code></pre></div>
<h2 id="queue-management">Queue Management<a class="headerlink" href="#queue-management" title="Permanent link">&para;</a></h2>
<h3 id="queue-statistics">Queue Statistics<a class="headerlink" href="#queue-statistics" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c1"># Get comprehensive queue statistics</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="n">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">transport</span><span class="o">.</span><span class="n">queue_stats</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="c1"># Example output:</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="c1"># {</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="c1">#   &quot;smart_message.queue.#_*_payment_service&quot; =&gt; { </span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="c1">#     length: 42, </span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="c1">#     pattern: &quot;#.*.payment_service&quot;,</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="c1">#     consumers: 2,</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="c1">#     consumer_group: &quot;payment_workers&quot;,</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="c1">#     last_activity: Time.now - 30</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="c1">#   },</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="c1">#   &quot;smart_message.queue.order_#_*_*&quot; =&gt; {</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="c1">#     length: 0,</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="c1">#     pattern: &quot;order.#.*.*&quot;, </span>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="c1">#     consumers: 3,</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="c1">#     consumer_group: &quot;order_workers&quot;,</span>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a><span class="c1">#     last_activity: Time.now - 5</span>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a><span class="c1">#   }</span>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a><span class="c1"># }</span>
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a>
</span><span id="__span-19-22"><a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a><span class="c1"># Process statistics</span>
</span><span id="__span-19-23"><a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a><span class="n">stats</span><span class="o">.</span><span class="n">each</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">queue_name</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="o">|</span>
</span><span id="__span-19-24"><a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a><span class="w">  </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Queue: </span><span class="si">#{</span><span class="n">queue_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-19-25"><a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a><span class="w">  </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;  Messages: </span><span class="si">#{</span><span class="n">info</span><span class="o">[</span><span class="ss">:length</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-19-26"><a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a><span class="w">  </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;  Consumers: </span><span class="si">#{</span><span class="n">info</span><span class="o">[</span><span class="ss">:consumers</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-19-27"><a id="__codelineno-19-27" name="__codelineno-19-27" href="#__codelineno-19-27"></a><span class="w">  </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;  Pattern: </span><span class="si">#{</span><span class="n">info</span><span class="o">[</span><span class="ss">:pattern</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-19-28"><a id="__codelineno-19-28" name="__codelineno-19-28" href="#__codelineno-19-28"></a><span class="w">  </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;  Last Activity: </span><span class="si">#{</span><span class="n">info</span><span class="o">[</span><span class="ss">:last_activity</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-19-29"><a id="__codelineno-19-29" name="__codelineno-19-29" href="#__codelineno-19-29"></a><span class="w">  </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><span id="__span-19-30"><a id="__codelineno-19-30" name="__codelineno-19-30" href="#__codelineno-19-30"></a><span class="k">end</span>
</span></code></pre></div>
<h3 id="routing-table-inspection">Routing Table Inspection<a class="headerlink" href="#routing-table-inspection" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1"># View active routing patterns and their mappings</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="n">routing_table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">transport</span><span class="o">.</span><span class="n">routing_table</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="c1"># Example output:</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="c1"># {</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="c1">#   &quot;#.*.payment_service&quot; =&gt; [&quot;smart_message.queue.#_*_payment_service&quot;],</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="c1">#   &quot;order.#.*.*&quot; =&gt; [&quot;smart_message.queue.order_#_*_*&quot;],</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="c1">#   &quot;#.admin_service.*&quot; =&gt; [&quot;smart_message.queue.#_admin_service_*&quot;]</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="c1"># }</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="c1"># Analyze routing patterns</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="n">routing_table</span><span class="o">.</span><span class="n">each</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">pattern</span><span class="p">,</span><span class="w"> </span><span class="n">queues</span><span class="o">|</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="w">  </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Pattern &#39;</span><span class="si">#{</span><span class="n">pattern</span><span class="si">}</span><span class="s2">&#39;:&quot;</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="w">  </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;  Routes to </span><span class="si">#{</span><span class="n">queues</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2"> queue(s):&quot;</span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a><span class="w">  </span><span class="n">queues</span><span class="o">.</span><span class="n">each</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">|</span><span class="n">queue</span><span class="o">|</span><span class="w"> </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;    - </span><span class="si">#{</span><span class="n">queue</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a><span class="w">  </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a><span class="k">end</span>
</span></code></pre></div>
<h3 id="queue-health-monitoring">Queue Health Monitoring<a class="headerlink" href="#queue-health-monitoring" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1"># Monitor queue health and performance</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">monitor_queue_health</span><span class="p">(</span><span class="n">transport</span><span class="p">)</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="w">  </span><span class="n">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">transport</span><span class="o">.</span><span class="n">queue_stats</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w">  </span><span class="n">health_issues</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[]</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="w">  </span><span class="n">stats</span><span class="o">.</span><span class="n">each</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">queue_name</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="o">|</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="w">    </span><span class="c1"># Check for potential issues</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">info</span><span class="o">[</span><span class="ss">:length</span><span class="o">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="w">      </span><span class="n">health_issues</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s2">&quot;WARNING: Queue </span><span class="si">#{</span><span class="n">queue_name</span><span class="si">}</span><span class="s2"> has </span><span class="si">#{</span><span class="n">info</span><span class="o">[</span><span class="ss">:length</span><span class="o">]</span><span class="si">}</span><span class="s2"> messages (high load)&quot;</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="w">    </span><span class="k">elsif</span><span class="w"> </span><span class="n">info</span><span class="o">[</span><span class="ss">:length</span><span class="o">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">info</span><span class="o">[</span><span class="ss">:consumers</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="w">      </span><span class="n">health_issues</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s2">&quot;ERROR: Queue </span><span class="si">#{</span><span class="n">queue_name</span><span class="si">}</span><span class="s2"> has messages but no consumers&quot;</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="w">    </span><span class="k">elsif</span><span class="w"> </span><span class="n">info</span><span class="o">[</span><span class="ss">:consumers</span><span class="o">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="w">      </span><span class="n">health_issues</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s2">&quot;INFO: Queue </span><span class="si">#{</span><span class="n">queue_name</span><span class="si">}</span><span class="s2"> has </span><span class="si">#{</span><span class="n">info</span><span class="o">[</span><span class="ss">:consumers</span><span class="o">]</span><span class="si">}</span><span class="s2"> consumers (possible over-provisioning)&quot;</span>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a>
</span><span id="__span-21-16"><a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a><span class="w">    </span><span class="c1"># Check for stale queues</span>
</span><span id="__span-21-17"><a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">info</span><span class="o">[</span><span class="ss">:last_activity</span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">info</span><span class="o">[</span><span class="ss">:last_activity</span><span class="o">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">300</span><span class="w">  </span><span class="c1"># 5 minutes</span>
</span><span id="__span-21-18"><a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a><span class="w">      </span><span class="n">health_issues</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s2">&quot;WARNING: Queue </span><span class="si">#{</span><span class="n">queue_name</span><span class="si">}</span><span class="s2"> inactive for </span><span class="si">#{</span><span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">info</span><span class="o">[</span><span class="ss">:last_activity</span><span class="o">]</span><span class="si">}</span><span class="s2"> seconds&quot;</span>
</span><span id="__span-21-19"><a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-21-20"><a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-21-21"><a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a>
</span><span id="__span-21-22"><a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">health_issues</span><span class="o">.</span><span class="n">any?</span>
</span><span id="__span-21-23"><a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a><span class="w">    </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Queue Health Issues:&quot;</span>
</span><span id="__span-21-24"><a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a><span class="w">    </span><span class="n">health_issues</span><span class="o">.</span><span class="n">each</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">|</span><span class="n">issue</span><span class="o">|</span><span class="w"> </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;  </span><span class="si">#{</span><span class="n">issue</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-21-25"><a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a><span class="w">  </span><span class="k">else</span>
</span><span id="__span-21-26"><a id="__codelineno-21-26" name="__codelineno-21-26" href="#__codelineno-21-26"></a><span class="w">    </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;All queues healthy ‚úÖ&quot;</span>
</span><span id="__span-21-27"><a id="__codelineno-21-27" name="__codelineno-21-27" href="#__codelineno-21-27"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-21-28"><a id="__codelineno-21-28" name="__codelineno-21-28" href="#__codelineno-21-28"></a>
</span><span id="__span-21-29"><a id="__codelineno-21-29" name="__codelineno-21-29" href="#__codelineno-21-29"></a><span class="w">  </span><span class="n">health_issues</span>
</span><span id="__span-21-30"><a id="__codelineno-21-30" name="__codelineno-21-30" href="#__codelineno-21-30"></a><span class="k">end</span>
</span><span id="__span-21-31"><a id="__codelineno-21-31" name="__codelineno-21-31" href="#__codelineno-21-31"></a>
</span><span id="__span-21-32"><a id="__codelineno-21-32" name="__codelineno-21-32" href="#__codelineno-21-32"></a><span class="c1"># Run health check</span>
</span><span id="__span-21-33"><a id="__codelineno-21-33" name="__codelineno-21-33" href="#__codelineno-21-33"></a><span class="n">health_issues</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">monitor_queue_health</span><span class="p">(</span><span class="n">transport</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="administrative-operations">Administrative Operations<a class="headerlink" href="#administrative-operations" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="c1"># Clear specific queue</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="n">transport</span><span class="o">.</span><span class="n">clear_queue</span><span class="p">(</span><span class="s2">&quot;smart_message.queue.#_*_test_service&quot;</span><span class="p">)</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="c1"># Clear all queues for consumer group</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="n">transport</span><span class="o">.</span><span class="n">clear_consumer_group_queues</span><span class="p">(</span><span class="s2">&quot;test_workers&quot;</span><span class="p">)</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="c1"># Get queue length</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">transport</span><span class="o">.</span><span class="n">queue_length</span><span class="p">(</span><span class="s2">&quot;smart_message.queue.order_#_*_*&quot;</span><span class="p">)</span>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Order queue length: </span><span class="si">#{</span><span class="n">length</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="c1"># Pause/resume consumer groups</span>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="n">transport</span><span class="o">.</span><span class="n">pause_consumer_group</span><span class="p">(</span><span class="s2">&quot;maintenance_workers&quot;</span><span class="p">)</span>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a><span class="n">transport</span><span class="o">.</span><span class="n">resume_consumer_group</span><span class="p">(</span><span class="s2">&quot;maintenance_workers&quot;</span><span class="p">)</span>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a>
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a><span class="c1"># Get consumer group information</span>
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a><span class="n">consumer_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">transport</span><span class="o">.</span><span class="n">consumer_group_info</span><span class="p">(</span><span class="s2">&quot;order_workers&quot;</span><span class="p">)</span>
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Consumer group info: </span><span class="si">#{</span><span class="n">consumer_info</span><span class="si">}</span><span class="s2">&quot;</span>
</span></code></pre></div>
<h2 id="error-handling-and-reliability">Error Handling and Reliability<a class="headerlink" href="#error-handling-and-reliability" title="Permanent link">&para;</a></h2>
<h3 id="retry-mechanisms">Retry Mechanisms<a class="headerlink" href="#retry-mechanisms" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ReliableMessage</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="no">SmartMessage</span><span class="o">::</span><span class="no">Base</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="w">  </span><span class="n">transport</span><span class="w"> </span><span class="ss">:redis_queue</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="w">    </span><span class="ss">max_retries</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="w">    </span><span class="ss">retry_delay</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">           </span><span class="c1"># 5 seconds between retries</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">    </span><span class="ss">exponential_backoff</span><span class="p">:</span><span class="w"> </span><span class="kp">true</span><span class="w"> </span><span class="c1"># 5s, 25s, 125s delays</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="w">  </span><span class="n">property</span><span class="w"> </span><span class="ss">:data</span><span class="p">,</span><span class="w"> </span><span class="ss">required</span><span class="p">:</span><span class="w"> </span><span class="kp">true</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">process</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="w">    </span><span class="k">begin</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="w">      </span><span class="c1"># Potentially failing operation</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="w">      </span><span class="n">external_service</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="w">    </span><span class="k">rescue</span><span class="w"> </span><span class="no">ExternalService</span><span class="o">::</span><span class="no">TemporaryError</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">e</span>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="w">      </span><span class="c1"># Retryable error - will be retried automatically</span>
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="w">      </span><span class="k">raise</span><span class="w"> </span><span class="no">SmartMessage</span><span class="o">::</span><span class="no">Errors</span><span class="o">::</span><span class="no">RetryableError</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="o">.</span><span class="n">message</span>
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a><span class="w">    </span><span class="k">rescue</span><span class="w"> </span><span class="no">ExternalService</span><span class="o">::</span><span class="no">ValidationError</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">e</span>
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a><span class="w">      </span><span class="c1"># Permanent error - goes to dead letter queue</span>
</span><span id="__span-23-19"><a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a><span class="w">      </span><span class="k">raise</span><span class="w"> </span><span class="no">SmartMessage</span><span class="o">::</span><span class="no">Errors</span><span class="o">::</span><span class="no">PermanentError</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="o">.</span><span class="n">message</span>
</span><span id="__span-23-20"><a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-23-21"><a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-23-22"><a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a><span class="k">end</span>
</span></code></pre></div>
<h3 id="dead-letter-queue">Dead Letter Queue<a class="headerlink" href="#dead-letter-queue" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="c1"># Configure dead letter queue</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="n">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">SmartMessage</span><span class="o">::</span><span class="no">Transport</span><span class="o">::</span><span class="no">RedisQueueTransport</span><span class="o">.</span><span class="n">new</span><span class="p">({</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="w">  </span><span class="ss">dead_letter_queue</span><span class="p">:</span><span class="w"> </span><span class="kp">true</span><span class="p">,</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="w">  </span><span class="ss">dead_letter_prefix</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;dlq&#39;</span><span class="p">,</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="w">  </span><span class="ss">max_retries</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="p">})</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="c1"># Monitor dead letter queue</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="n">dlq_stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">transport</span><span class="o">.</span><span class="n">dead_letter_stats</span>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Dead letter messages: </span><span class="si">#{</span><span class="n">dlq_stats</span><span class="o">[</span><span class="ss">:count</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Recent errors: </span><span class="si">#{</span><span class="n">dlq_stats</span><span class="o">[</span><span class="ss">:recent_errors</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a><span class="c1"># Process dead letter messages</span>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a><span class="n">transport</span><span class="o">.</span><span class="n">process_dead_letters</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">message_data</span><span class="p">,</span><span class="w"> </span><span class="n">error_info</span><span class="o">|</span>
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a><span class="w">  </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Dead letter: </span><span class="si">#{</span><span class="n">message_data</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a><span class="w">  </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Error: </span><span class="si">#{</span><span class="n">error_info</span><span class="o">[</span><span class="ss">:error_message</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-24-17"><a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a><span class="w">  </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Retry count: </span><span class="si">#{</span><span class="n">error_info</span><span class="o">[</span><span class="ss">:retry_count</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-24-18"><a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a>
</span><span id="__span-24-19"><a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a><span class="w">  </span><span class="c1"># Decide whether to retry, route elsewhere, or discard</span>
</span><span id="__span-24-20"><a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">error_info</span><span class="o">[</span><span class="ss">:retry_count</span><span class="o">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">fixable_error?</span><span class="p">(</span><span class="n">error_info</span><span class="o">[</span><span class="ss">:error_message</span><span class="o">]</span><span class="p">)</span>
</span><span id="__span-24-21"><a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a><span class="w">    </span><span class="ss">:retry</span><span class="w">  </span><span class="c1"># Retry the message</span>
</span><span id="__span-24-22"><a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a><span class="w">  </span><span class="k">else</span>
</span><span id="__span-24-23"><a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a><span class="w">    </span><span class="ss">:discard</span><span class="w">  </span><span class="c1"># Discard the message</span>
</span><span id="__span-24-24"><a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-24-25"><a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a><span class="k">end</span>
</span></code></pre></div>
<h3 id="circuit-breaker-pattern">Circuit Breaker Pattern<a class="headerlink" href="#circuit-breaker-pattern" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">CircuitBreakerMessage</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="no">SmartMessage</span><span class="o">::</span><span class="no">Base</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="w">  </span><span class="n">transport</span><span class="w"> </span><span class="ss">:redis_queue</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">    </span><span class="ss">circuit_breaker</span><span class="p">:</span><span class="w"> </span><span class="kp">true</span><span class="p">,</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="w">    </span><span class="ss">failure_threshold</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">    </span><span class="c1"># Open circuit after 5 failures</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="w">    </span><span class="ss">recovery_timeout</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span><span class="p">,</span><span class="w">    </span><span class="c1"># Try again after 60 seconds</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="w">    </span><span class="ss">half_open_max_calls</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w">   </span><span class="c1"># Allow 3 calls when half-open</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">process</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="w">    </span><span class="c1"># External service call</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="w">    </span><span class="n">external_service</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="k">end</span>
</span></code></pre></div>
<h2 id="use-cases-and-examples">Use Cases and Examples<a class="headerlink" href="#use-cases-and-examples" title="Permanent link">&para;</a></h2>
<h3 id="microservices-communication">Microservices Communication<a class="headerlink" href="#microservices-communication" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="c1"># API Gateway routing requests to services</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">ServiceRequest</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="no">SmartMessage</span><span class="o">::</span><span class="no">Base</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="w">  </span><span class="n">transport</span><span class="w"> </span><span class="ss">:redis_queue</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="w">  </span><span class="n">property</span><span class="w"> </span><span class="ss">:service_name</span><span class="p">,</span><span class="w"> </span><span class="ss">required</span><span class="p">:</span><span class="w"> </span><span class="kp">true</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="w">  </span><span class="n">property</span><span class="w"> </span><span class="ss">:operation</span><span class="p">,</span><span class="w"> </span><span class="ss">required</span><span class="p">:</span><span class="w"> </span><span class="kp">true</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="w">  </span><span class="n">property</span><span class="w"> </span><span class="ss">:payload</span><span class="p">,</span><span class="w"> </span><span class="ss">default</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="k">end</span>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a><span class="c1"># Route based on service name</span>
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a><span class="n">api_gateway_transport</span><span class="o">.</span><span class="n">where</span>
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a><span class="w">  </span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="s1">&#39;ServiceRequest&#39;</span><span class="p">)</span>
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a><span class="w">  </span><span class="o">.</span><span class="n">subscribe</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">message_class</span><span class="p">,</span><span class="w"> </span><span class="n">message_data</span><span class="o">|</span>
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a><span class="w">    </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">message_data</span><span class="p">)</span>
</span><span id="__span-26-15"><a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a>
</span><span id="__span-26-16"><a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a><span class="w">    </span><span class="c1"># Forward to appropriate service</span>
</span><span id="__span-26-17"><a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a><span class="w">    </span><span class="no">ServiceRequest</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="__span-26-18"><a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a><span class="w">      </span><span class="s1">&#39;_sm_header&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-19"><a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a><span class="w">        </span><span class="s1">&#39;from&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s1">&#39;api_gateway&#39;</span><span class="p">,</span>
</span><span id="__span-26-20"><a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a><span class="w">        </span><span class="s1">&#39;to&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">request</span><span class="o">[</span><span class="s1">&#39;service_name&#39;</span><span class="o">]</span>
</span><span id="__span-26-21"><a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-26-22"><a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a><span class="w">    </span><span class="p">))</span><span class="o">.</span><span class="n">publish</span>
</span><span id="__span-26-23"><a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-26-24"><a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a>
</span><span id="__span-26-25"><a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a><span class="c1"># Services subscribe to their own requests</span>
</span><span id="__span-26-26"><a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a><span class="n">user_service_transport</span><span class="o">.</span><span class="n">where</span>
</span><span id="__span-26-27"><a id="__codelineno-26-27" name="__codelineno-26-27" href="#__codelineno-26-27"></a><span class="w">  </span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;user_service&#39;</span><span class="p">)</span>
</span><span id="__span-26-28"><a id="__codelineno-26-28" name="__codelineno-26-28" href="#__codelineno-26-28"></a><span class="w">  </span><span class="o">.</span><span class="n">consumer_group</span><span class="p">(</span><span class="s1">&#39;user_workers&#39;</span><span class="p">)</span>
</span><span id="__span-26-29"><a id="__codelineno-26-29" name="__codelineno-26-29" href="#__codelineno-26-29"></a><span class="w">  </span><span class="o">.</span><span class="n">subscribe</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">message_class</span><span class="p">,</span><span class="w"> </span><span class="n">message_data</span><span class="o">|</span>
</span><span id="__span-26-30"><a id="__codelineno-26-30" name="__codelineno-26-30" href="#__codelineno-26-30"></a><span class="w">    </span><span class="c1"># Process user service request</span>
</span><span id="__span-26-31"><a id="__codelineno-26-31" name="__codelineno-26-31" href="#__codelineno-26-31"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-26-32"><a id="__codelineno-26-32" name="__codelineno-26-32" href="#__codelineno-26-32"></a>
</span><span id="__span-26-33"><a id="__codelineno-26-33" name="__codelineno-26-33" href="#__codelineno-26-33"></a><span class="n">payment_service_transport</span><span class="o">.</span><span class="n">where</span>
</span><span id="__span-26-34"><a id="__codelineno-26-34" name="__codelineno-26-34" href="#__codelineno-26-34"></a><span class="w">  </span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;payment_service&#39;</span><span class="p">)</span>
</span><span id="__span-26-35"><a id="__codelineno-26-35" name="__codelineno-26-35" href="#__codelineno-26-35"></a><span class="w">  </span><span class="o">.</span><span class="n">consumer_group</span><span class="p">(</span><span class="s1">&#39;payment_workers&#39;</span><span class="p">)</span>
</span><span id="__span-26-36"><a id="__codelineno-26-36" name="__codelineno-26-36" href="#__codelineno-26-36"></a><span class="w">  </span><span class="o">.</span><span class="n">subscribe</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">message_class</span><span class="p">,</span><span class="w"> </span><span class="n">message_data</span><span class="o">|</span>
</span><span id="__span-26-37"><a id="__codelineno-26-37" name="__codelineno-26-37" href="#__codelineno-26-37"></a><span class="w">    </span><span class="c1"># Process payment service request  </span>
</span><span id="__span-26-38"><a id="__codelineno-26-38" name="__codelineno-26-38" href="#__codelineno-26-38"></a><span class="w">  </span><span class="k">end</span>
</span></code></pre></div>
<h3 id="event-driven-architecture">Event-Driven Architecture<a class="headerlink" href="#event-driven-architecture" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="c1"># Order processing workflow</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">OrderPlaced</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="no">SmartMessage</span><span class="o">::</span><span class="no">Base</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="w">  </span><span class="n">transport</span><span class="w"> </span><span class="ss">:redis_queue</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="w">  </span><span class="n">property</span><span class="w"> </span><span class="ss">:order_id</span><span class="p">,</span><span class="w"> </span><span class="ss">required</span><span class="p">:</span><span class="w"> </span><span class="kp">true</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="w">  </span><span class="n">property</span><span class="w"> </span><span class="ss">:customer_id</span><span class="p">,</span><span class="w"> </span><span class="ss">required</span><span class="p">:</span><span class="w"> </span><span class="kp">true</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="w">  </span><span class="n">property</span><span class="w"> </span><span class="ss">:items</span><span class="p">,</span><span class="w"> </span><span class="ss">required</span><span class="p">:</span><span class="w"> </span><span class="kp">true</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="k">end</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="c1"># Multiple services process order events</span>
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="n">inventory_service</span><span class="o">.</span><span class="n">where</span>
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a><span class="w">  </span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="s1">&#39;OrderPlaced&#39;</span><span class="p">)</span>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a><span class="w">  </span><span class="o">.</span><span class="n">consumer_group</span><span class="p">(</span><span class="s1">&#39;inventory_workers&#39;</span><span class="p">)</span>
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a><span class="w">  </span><span class="o">.</span><span class="n">subscribe</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">message_class</span><span class="p">,</span><span class="w"> </span><span class="n">message_data</span><span class="o">|</span>
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a><span class="w">    </span><span class="c1"># Reserve inventory</span>
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-27-17"><a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a>
</span><span id="__span-27-18"><a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a><span class="n">payment_service</span><span class="o">.</span><span class="n">where</span>
</span><span id="__span-27-19"><a id="__codelineno-27-19" name="__codelineno-27-19" href="#__codelineno-27-19"></a><span class="w">  </span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="s1">&#39;OrderPlaced&#39;</span><span class="p">)</span>
</span><span id="__span-27-20"><a id="__codelineno-27-20" name="__codelineno-27-20" href="#__codelineno-27-20"></a><span class="w">  </span><span class="o">.</span><span class="n">consumer_group</span><span class="p">(</span><span class="s1">&#39;payment_workers&#39;</span><span class="p">)</span>
</span><span id="__span-27-21"><a id="__codelineno-27-21" name="__codelineno-27-21" href="#__codelineno-27-21"></a><span class="w">  </span><span class="o">.</span><span class="n">subscribe</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">message_class</span><span class="p">,</span><span class="w"> </span><span class="n">message_data</span><span class="o">|</span>
</span><span id="__span-27-22"><a id="__codelineno-27-22" name="__codelineno-27-22" href="#__codelineno-27-22"></a><span class="w">    </span><span class="c1"># Process payment</span>
</span><span id="__span-27-23"><a id="__codelineno-27-23" name="__codelineno-27-23" href="#__codelineno-27-23"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-27-24"><a id="__codelineno-27-24" name="__codelineno-27-24" href="#__codelineno-27-24"></a>
</span><span id="__span-27-25"><a id="__codelineno-27-25" name="__codelineno-27-25" href="#__codelineno-27-25"></a><span class="n">shipping_service</span><span class="o">.</span><span class="n">where</span>
</span><span id="__span-27-26"><a id="__codelineno-27-26" name="__codelineno-27-26" href="#__codelineno-27-26"></a><span class="w">  </span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="s1">&#39;OrderPlaced&#39;</span><span class="p">)</span>
</span><span id="__span-27-27"><a id="__codelineno-27-27" name="__codelineno-27-27" href="#__codelineno-27-27"></a><span class="w">  </span><span class="o">.</span><span class="n">consumer_group</span><span class="p">(</span><span class="s1">&#39;shipping_workers&#39;</span><span class="p">)</span>
</span><span id="__span-27-28"><a id="__codelineno-27-28" name="__codelineno-27-28" href="#__codelineno-27-28"></a><span class="w">  </span><span class="o">.</span><span class="n">subscribe</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">message_class</span><span class="p">,</span><span class="w"> </span><span class="n">message_data</span><span class="o">|</span>
</span><span id="__span-27-29"><a id="__codelineno-27-29" name="__codelineno-27-29" href="#__codelineno-27-29"></a><span class="w">    </span><span class="c1"># Arrange shipping</span>
</span><span id="__span-27-30"><a id="__codelineno-27-30" name="__codelineno-27-30" href="#__codelineno-27-30"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-27-31"><a id="__codelineno-27-31" name="__codelineno-27-31" href="#__codelineno-27-31"></a>
</span><span id="__span-27-32"><a id="__codelineno-27-32" name="__codelineno-27-32" href="#__codelineno-27-32"></a><span class="n">analytics_service</span><span class="o">.</span><span class="n">where</span>
</span><span id="__span-27-33"><a id="__codelineno-27-33" name="__codelineno-27-33" href="#__codelineno-27-33"></a><span class="w">  </span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="s1">&#39;OrderPlaced&#39;</span><span class="p">)</span>
</span><span id="__span-27-34"><a id="__codelineno-27-34" name="__codelineno-27-34" href="#__codelineno-27-34"></a><span class="w">  </span><span class="o">.</span><span class="n">consumer_group</span><span class="p">(</span><span class="s1">&#39;analytics_workers&#39;</span><span class="p">)</span>
</span><span id="__span-27-35"><a id="__codelineno-27-35" name="__codelineno-27-35" href="#__codelineno-27-35"></a><span class="w">  </span><span class="o">.</span><span class="n">subscribe</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">message_class</span><span class="p">,</span><span class="w"> </span><span class="n">message_data</span><span class="o">|</span>
</span><span id="__span-27-36"><a id="__codelineno-27-36" name="__codelineno-27-36" href="#__codelineno-27-36"></a><span class="w">    </span><span class="c1"># Track metrics</span>
</span><span id="__span-27-37"><a id="__codelineno-27-37" name="__codelineno-27-37" href="#__codelineno-27-37"></a><span class="w">  </span><span class="k">end</span>
</span></code></pre></div>
<h3 id="multi-tenant-systems">Multi-Tenant Systems<a class="headerlink" href="#multi-tenant-systems" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c1"># Tenant isolation via routing</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">TenantMessage</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="no">SmartMessage</span><span class="o">::</span><span class="no">Base</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="w">  </span><span class="n">transport</span><span class="w"> </span><span class="ss">:redis_queue</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="w">  </span><span class="n">property</span><span class="w"> </span><span class="ss">:tenant_id</span><span class="p">,</span><span class="w"> </span><span class="ss">required</span><span class="p">:</span><span class="w"> </span><span class="kp">true</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="w">  </span><span class="n">property</span><span class="w"> </span><span class="ss">:data</span><span class="p">,</span><span class="w"> </span><span class="ss">required</span><span class="p">:</span><span class="w"> </span><span class="kp">true</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="k">end</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="c1"># Each tenant gets isolated message processing</span>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="n">tenant_transport</span><span class="o">.</span><span class="n">where</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="w">  </span><span class="o">.</span><span class="n">from</span><span class="p">(</span><span class="sr">/^tenant_</span><span class="si">#{</span><span class="n">tenant_id</span><span class="si">}</span><span class="sr">_.*/</span><span class="p">)</span>
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="w">  </span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="sr">/^tenant_</span><span class="si">#{</span><span class="n">tenant_id</span><span class="si">}</span><span class="sr">_.*/</span><span class="p">)</span>
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a><span class="w">  </span><span class="o">.</span><span class="n">consumer_group</span><span class="p">(</span><span class="s2">&quot;tenant_</span><span class="si">#{</span><span class="n">tenant_id</span><span class="si">}</span><span class="s2">_workers&quot;</span><span class="p">)</span>
</span><span id="__span-28-14"><a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a><span class="w">  </span><span class="o">.</span><span class="n">subscribe</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">message_class</span><span class="p">,</span><span class="w"> </span><span class="n">message_data</span><span class="o">|</span>
</span><span id="__span-28-15"><a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a><span class="w">    </span><span class="c1"># Process tenant-specific message</span>
</span><span id="__span-28-16"><a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-28-17"><a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a>
</span><span id="__span-28-18"><a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a><span class="c1"># Admin messages broadcast to all tenants</span>
</span><span id="__span-28-19"><a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a><span class="n">admin_transport</span><span class="o">.</span><span class="n">where</span>
</span><span id="__span-28-20"><a id="__codelineno-28-20" name="__codelineno-28-20" href="#__codelineno-28-20"></a><span class="w">  </span><span class="o">.</span><span class="n">from</span><span class="p">(</span><span class="s1">&#39;admin_service&#39;</span><span class="p">)</span>
</span><span id="__span-28-21"><a id="__codelineno-28-21" name="__codelineno-28-21" href="#__codelineno-28-21"></a><span class="w">  </span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;broadcast&#39;</span><span class="p">)</span>
</span><span id="__span-28-22"><a id="__codelineno-28-22" name="__codelineno-28-22" href="#__codelineno-28-22"></a><span class="w">  </span><span class="o">.</span><span class="n">subscribe</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">message_class</span><span class="p">,</span><span class="w"> </span><span class="n">message_data</span><span class="o">|</span>
</span><span id="__span-28-23"><a id="__codelineno-28-23" name="__codelineno-28-23" href="#__codelineno-28-23"></a><span class="w">    </span><span class="c1"># Process admin broadcast</span>
</span><span id="__span-28-24"><a id="__codelineno-28-24" name="__codelineno-28-24" href="#__codelineno-28-24"></a><span class="w">  </span><span class="k">end</span>
</span></code></pre></div>
<h3 id="real-time-monitoring-and-alerting">Real-Time Monitoring and Alerting<a class="headerlink" href="#real-time-monitoring-and-alerting" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="c1"># Monitoring system with alert routing</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">MetricMessage</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="no">SmartMessage</span><span class="o">::</span><span class="no">Base</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="w">  </span><span class="n">transport</span><span class="w"> </span><span class="ss">:redis_queue</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="w">  </span><span class="n">property</span><span class="w"> </span><span class="ss">:metric_name</span><span class="p">,</span><span class="w"> </span><span class="ss">required</span><span class="p">:</span><span class="w"> </span><span class="kp">true</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="w">  </span><span class="n">property</span><span class="w"> </span><span class="ss">:value</span><span class="p">,</span><span class="w"> </span><span class="ss">required</span><span class="p">:</span><span class="w"> </span><span class="kp">true</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="w">  </span><span class="n">property</span><span class="w"> </span><span class="ss">:threshold</span><span class="p">,</span><span class="w"> </span><span class="ss">required</span><span class="p">:</span><span class="w"> </span><span class="kp">true</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="w">  </span><span class="n">property</span><span class="w"> </span><span class="ss">:severity</span><span class="p">,</span><span class="w"> </span><span class="ss">default</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;info&#39;</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="k">end</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="c1"># Route based on severity</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="n">monitoring_transport</span><span class="o">.</span><span class="n">where</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a><span class="w">  </span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="s1">&#39;MetricMessage&#39;</span><span class="p">)</span>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a><span class="w">  </span><span class="o">.</span><span class="n">subscribe</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">message_class</span><span class="p">,</span><span class="w"> </span><span class="n">message_data</span><span class="o">|</span>
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a><span class="w">    </span><span class="n">metric</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">message_data</span><span class="p">)</span>
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a>
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">metric</span><span class="o">[</span><span class="s1">&#39;value&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">metric</span><span class="o">[</span><span class="s1">&#39;threshold&#39;</span><span class="o">]</span>
</span><span id="__span-29-18"><a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a><span class="w">      </span><span class="n">severity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">metric</span><span class="o">[</span><span class="s1">&#39;value&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">metric</span><span class="o">[</span><span class="s1">&#39;threshold&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-29-19"><a id="__codelineno-29-19" name="__codelineno-29-19" href="#__codelineno-29-19"></a><span class="w">                   </span><span class="s1">&#39;critical&#39;</span>
</span><span id="__span-29-20"><a id="__codelineno-29-20" name="__codelineno-29-20" href="#__codelineno-29-20"></a><span class="w">                 </span><span class="k">elsif</span><span class="w"> </span><span class="n">metric</span><span class="o">[</span><span class="s1">&#39;value&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">metric</span><span class="o">[</span><span class="s1">&#39;threshold&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1</span><span class="o">.</span><span class="mi">5</span>
</span><span id="__span-29-21"><a id="__codelineno-29-21" name="__codelineno-29-21" href="#__codelineno-29-21"></a><span class="w">                   </span><span class="s1">&#39;warning&#39;</span>
</span><span id="__span-29-22"><a id="__codelineno-29-22" name="__codelineno-29-22" href="#__codelineno-29-22"></a><span class="w">                 </span><span class="k">else</span>
</span><span id="__span-29-23"><a id="__codelineno-29-23" name="__codelineno-29-23" href="#__codelineno-29-23"></a><span class="w">                   </span><span class="s1">&#39;info&#39;</span>
</span><span id="__span-29-24"><a id="__codelineno-29-24" name="__codelineno-29-24" href="#__codelineno-29-24"></a><span class="w">                 </span><span class="k">end</span>
</span><span id="__span-29-25"><a id="__codelineno-29-25" name="__codelineno-29-25" href="#__codelineno-29-25"></a>
</span><span id="__span-29-26"><a id="__codelineno-29-26" name="__codelineno-29-26" href="#__codelineno-29-26"></a><span class="w">      </span><span class="no">AlertMessage</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
</span><span id="__span-29-27"><a id="__codelineno-29-27" name="__codelineno-29-27" href="#__codelineno-29-27"></a><span class="w">        </span><span class="ss">alert_type</span><span class="p">:</span><span class="w"> </span><span class="n">metric</span><span class="o">[</span><span class="s1">&#39;metric_name&#39;</span><span class="o">]</span><span class="p">,</span>
</span><span id="__span-29-28"><a id="__codelineno-29-28" name="__codelineno-29-28" href="#__codelineno-29-28"></a><span class="w">        </span><span class="ss">message</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">metric</span><span class="o">[</span><span class="s1">&#39;metric_name&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2"> is </span><span class="si">#{</span><span class="n">metric</span><span class="o">[</span><span class="s1">&#39;value&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2"> (threshold: </span><span class="si">#{</span><span class="n">metric</span><span class="o">[</span><span class="s1">&#39;threshold&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
</span><span id="__span-29-29"><a id="__codelineno-29-29" name="__codelineno-29-29" href="#__codelineno-29-29"></a><span class="w">        </span><span class="ss">severity</span><span class="p">:</span><span class="w"> </span><span class="n">severity</span><span class="p">,</span>
</span><span id="__span-29-30"><a id="__codelineno-29-30" name="__codelineno-29-30" href="#__codelineno-29-30"></a><span class="w">        </span><span class="ss">_sm_header</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-31"><a id="__codelineno-29-31" name="__codelineno-29-31" href="#__codelineno-29-31"></a><span class="w">          </span><span class="ss">from</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;monitoring_service&#39;</span><span class="p">,</span>
</span><span id="__span-29-32"><a id="__codelineno-29-32" name="__codelineno-29-32" href="#__codelineno-29-32"></a><span class="w">          </span><span class="ss">to</span><span class="p">:</span><span class="w"> </span><span class="n">severity</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;critical&#39;</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="s1">&#39;pager_duty&#39;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;alert_dashboard&#39;</span>
</span><span id="__span-29-33"><a id="__codelineno-29-33" name="__codelineno-29-33" href="#__codelineno-29-33"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-29-34"><a id="__codelineno-29-34" name="__codelineno-29-34" href="#__codelineno-29-34"></a><span class="w">      </span><span class="p">)</span><span class="o">.</span><span class="n">publish</span>
</span><span id="__span-29-35"><a id="__codelineno-29-35" name="__codelineno-29-35" href="#__codelineno-29-35"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-29-36"><a id="__codelineno-29-36" name="__codelineno-29-36" href="#__codelineno-29-36"></a><span class="w">  </span><span class="k">end</span>
</span></code></pre></div>
<h2 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link">&para;</a></h2>
<h3 id="naming-conventions">Naming Conventions<a class="headerlink" href="#naming-conventions" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="c1"># Use descriptive queue prefixes</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="n">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">SmartMessage</span><span class="o">::</span><span class="no">Transport</span><span class="o">::</span><span class="no">RedisQueueTransport</span><span class="o">.</span><span class="n">new</span><span class="p">({</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="w">  </span><span class="ss">queue_prefix</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;myapp.production.queues&#39;</span><span class="w">  </span><span class="c1"># Environment-specific</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="p">})</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="c1"># Use meaningful consumer group names</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a><span class="n">transport</span><span class="o">.</span><span class="n">where</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a><span class="w">  </span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;order_service&#39;</span><span class="p">)</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a><span class="w">  </span><span class="o">.</span><span class="n">consumer_group</span><span class="p">(</span><span class="s1">&#39;order_processors&#39;</span><span class="p">)</span><span class="w">  </span><span class="c1"># Descriptive group name</span>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a><span class="w">  </span><span class="o">.</span><span class="n">subscribe</span>
</span></code></pre></div>
<h3 id="resource-management">Resource Management<a class="headerlink" href="#resource-management" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="c1"># Proper cleanup on shutdown</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="nb">at_exit</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="w">  </span><span class="n">transport</span><span class="o">.</span><span class="n">disconnect</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="w">  </span><span class="n">transport</span><span class="o">.</span><span class="n">cleanup_consumer_groups</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="k">end</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="c1"># Connection pooling for high-throughput applications</span>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="n">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">SmartMessage</span><span class="o">::</span><span class="no">Transport</span><span class="o">::</span><span class="no">RedisQueueTransport</span><span class="o">.</span><span class="n">new</span><span class="p">({</span>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="w">  </span><span class="ss">pool_size</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="w">  </span><span class="ss">pool_timeout</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a><span class="p">})</span>
</span></code></pre></div>
<h3 id="monitoring-and-observability">Monitoring and Observability<a class="headerlink" href="#monitoring-and-observability" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="c1"># Regular health monitoring with Async</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="no">Async</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="w">  </span><span class="kp">loop</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="w">    </span><span class="n">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">transport</span><span class="o">.</span><span class="n">queue_stats</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="w">    </span><span class="c1"># Log queue lengths</span>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="w">    </span><span class="n">stats</span><span class="o">.</span><span class="n">each</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">queue</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="o">|</span>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="n">info</span><span class="o">[</span><span class="ss">:length</span><span class="o">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a><span class="w">        </span><span class="no">Rails</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="w"> </span><span class="s2">&quot;Queue </span><span class="si">#{</span><span class="n">queue</span><span class="si">}</span><span class="s2"> backing up: </span><span class="si">#{</span><span class="n">info</span><span class="o">[</span><span class="ss">:length</span><span class="o">]</span><span class="si">}</span><span class="s2"> messages&quot;</span>
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a><span class="w">      </span><span class="k">end</span>
</span><span id="__span-32-11"><a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-32-12"><a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a>
</span><span id="__span-32-13"><a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a><span class="w">    </span><span class="c1"># Check consumer health</span>
</span><span id="__span-32-14"><a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a><span class="w">    </span><span class="n">dead_consumers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stats</span><span class="o">.</span><span class="n">select</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">|</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="o">|</span><span class="w"> </span><span class="n">info</span><span class="o">[</span><span class="ss">:consumers</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">info</span><span class="o">[</span><span class="ss">:length</span><span class="o">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-32-15"><a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a><span class="w">    </span><span class="k">unless</span><span class="w"> </span><span class="n">dead_consumers</span><span class="o">.</span><span class="n">empty?</span>
</span><span id="__span-32-16"><a id="__codelineno-32-16" name="__codelineno-32-16" href="#__codelineno-32-16"></a><span class="w">      </span><span class="no">Rails</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="w"> </span><span class="s2">&quot;Queues with no consumers: </span><span class="si">#{</span><span class="n">dead_consumers</span><span class="o">.</span><span class="n">keys</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-32-17"><a id="__codelineno-32-17" name="__codelineno-32-17" href="#__codelineno-32-17"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-32-18"><a id="__codelineno-32-18" name="__codelineno-32-18" href="#__codelineno-32-18"></a>
</span><span id="__span-32-19"><a id="__codelineno-32-19" name="__codelineno-32-19" href="#__codelineno-32-19"></a><span class="w">    </span><span class="nb">sleep</span><span class="w"> </span><span class="mi">30</span>
</span><span id="__span-32-20"><a id="__codelineno-32-20" name="__codelineno-32-20" href="#__codelineno-32-20"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-32-21"><a id="__codelineno-32-21" name="__codelineno-32-21" href="#__codelineno-32-21"></a><span class="k">end</span>
</span></code></pre></div>
<h3 id="performance-optimization">Performance Optimization<a class="headerlink" href="#performance-optimization" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="c1"># Batch processing for high throughput</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="n">transport</span><span class="o">.</span><span class="n">where</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="w">  </span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;batch_processor&#39;</span><span class="p">)</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="w">  </span><span class="o">.</span><span class="n">subscribe</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">message_class</span><span class="p">,</span><span class="w"> </span><span class="n">message_data</span><span class="o">|</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="w">    </span><span class="c1"># Process in batches</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="w">    </span><span class="n">batch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[]</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="w">    </span><span class="n">batch</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">message_data</span><span class="p">)</span>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">batch</span><span class="o">.</span><span class="n">size</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">10</span><span class="w">  </span><span class="c1"># Process every 10 messages</span>
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a><span class="w">      </span><span class="n">process_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a><span class="w">      </span><span class="n">batch</span><span class="o">.</span><span class="n">clear</span>
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-33-14"><a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-33-15"><a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a>
</span><span id="__span-33-16"><a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a><span class="c1"># Use appropriate block times</span>
</span><span id="__span-33-17"><a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a><span class="n">fast_transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">SmartMessage</span><span class="o">::</span><span class="no">Transport</span><span class="o">::</span><span class="no">RedisQueueTransport</span><span class="o">.</span><span class="n">new</span><span class="p">({</span>
</span><span id="__span-33-18"><a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a><span class="w">  </span><span class="ss">block_time</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="w">  </span><span class="c1"># Low latency, higher CPU usage</span>
</span><span id="__span-33-19"><a id="__codelineno-33-19" name="__codelineno-33-19" href="#__codelineno-33-19"></a><span class="p">})</span>
</span><span id="__span-33-20"><a id="__codelineno-33-20" name="__codelineno-33-20" href="#__codelineno-33-20"></a>
</span><span id="__span-33-21"><a id="__codelineno-33-21" name="__codelineno-33-21" href="#__codelineno-33-21"></a><span class="n">efficient_transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">SmartMessage</span><span class="o">::</span><span class="no">Transport</span><span class="o">::</span><span class="no">RedisQueueTransport</span><span class="o">.</span><span class="n">new</span><span class="p">({</span>
</span><span id="__span-33-22"><a id="__codelineno-33-22" name="__codelineno-33-22" href="#__codelineno-33-22"></a><span class="w">  </span><span class="ss">block_time</span><span class="p">:</span><span class="w"> </span><span class="mi">5000</span><span class="w">  </span><span class="c1"># Higher latency, lower CPU usage</span>
</span><span id="__span-33-23"><a id="__codelineno-33-23" name="__codelineno-33-23" href="#__codelineno-33-23"></a><span class="p">})</span>
</span></code></pre></div>
<h2 id="migration-from-other-transports">Migration from Other Transports<a class="headerlink" href="#migration-from-other-transports" title="Permanent link">&para;</a></h2>
<h3 id="from-redis-pubsub">From Redis Pub/Sub<a class="headerlink" href="#from-redis-pubsub" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1"># Old Redis Pub/Sub approach</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">OrderMessage</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="no">SmartMessage</span><span class="o">::</span><span class="no">Base</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="w">  </span><span class="n">transport</span><span class="w"> </span><span class="ss">:redis</span><span class="w">  </span><span class="c1"># Simple pub/sub, everyone gets message</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="k">end</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="no">OrderMessage</span><span class="o">.</span><span class="n">subscribe</span><span class="w">  </span><span class="c1"># All subscribers get ALL messages</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="c1"># New Redis Queue approach</span>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">OrderMessage</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="no">SmartMessage</span><span class="o">::</span><span class="no">Base</span><span class="w">  </span>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a><span class="w">  </span><span class="n">transport</span><span class="w"> </span><span class="ss">:redis_queue</span><span class="w">  </span><span class="c1"># Queue-based with routing</span>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="k">end</span>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a>
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a><span class="c1"># Targeted subscriptions</span>
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a><span class="no">OrderMessage</span><span class="o">.</span><span class="n">where</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;order_processor&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">subscribe</span><span class="w">     </span><span class="c1"># Only my orders</span>
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a><span class="no">OrderMessage</span><span class="o">.</span><span class="n">where</span><span class="o">.</span><span class="n">from</span><span class="p">(</span><span class="s1">&#39;api_gateway&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">subscribe</span><span class="w">       </span><span class="c1"># Only from gateway</span>
</span><span id="__span-34-16"><a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a><span class="no">OrderMessage</span><span class="o">.</span><span class="n">subscribe_pattern</span><span class="p">(</span><span class="s2">&quot;#.*.order_service&quot;</span><span class="p">)</span><span class="w">    </span><span class="c1"># RabbitMQ-style patterns</span>
</span></code></pre></div>
<h3 id="from-rabbitmq">From RabbitMQ<a class="headerlink" href="#from-rabbitmq" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="c1"># RabbitMQ configuration</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">OrderMessage</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="no">SmartMessage</span><span class="o">::</span><span class="no">Base</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="w">  </span><span class="n">transport</span><span class="w"> </span><span class="ss">:rabbitmq</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="w">    </span><span class="ss">exchange</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;orders&#39;</span><span class="p">,</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="w">    </span><span class="ss">queue</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;order_processing&#39;</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="k">end</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="c1"># Equivalent Redis Queue configuration  </span>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">OrderMessage</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="no">SmartMessage</span><span class="o">::</span><span class="no">Base</span>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="w">  </span><span class="n">transport</span><span class="w"> </span><span class="ss">:redis_queue</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a><span class="w">    </span><span class="ss">queue_prefix</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;orders&#39;</span><span class="p">,</span>
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a><span class="w">    </span><span class="ss">consumer_group</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;order_processors&#39;</span>
</span><span id="__span-35-14"><a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-35-15"><a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a><span class="k">end</span>
</span><span id="__span-35-16"><a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a>
</span><span id="__span-35-17"><a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a><span class="c1"># Pattern subscriptions work identically</span>
</span><span id="__span-35-18"><a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a><span class="n">transport</span><span class="o">.</span><span class="n">subscribe_pattern</span><span class="p">(</span><span class="s2">&quot;#.*.order_service&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1"># Same syntax!</span>
</span></code></pre></div>
<h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">&para;</a></h2>
<h3 id="common-issues">Common Issues<a class="headerlink" href="#common-issues" title="Permanent link">&para;</a></h3>
<p><strong>Queue Not Processing Messages</strong>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="c1"># Check queue stats</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="n">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">transport</span><span class="o">.</span><span class="n">queue_stats</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Queue stats: </span><span class="si">#{</span><span class="n">stats</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="c1"># Verify pattern matching</span>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;#.*.my_service&quot;</span>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="n">test_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;order.ordermessage.api_gateway.my_service&quot;</span>
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a><span class="n">matches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">transport</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="ss">:routing_key_matches_pattern?</span><span class="p">,</span><span class="w"> </span><span class="n">test_key</span><span class="p">,</span><span class="w"> </span><span class="n">pattern</span><span class="p">)</span>
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Pattern &#39;</span><span class="si">#{</span><span class="n">pattern</span><span class="si">}</span><span class="s2">&#39; matches &#39;</span><span class="si">#{</span><span class="n">test_key</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">#{</span><span class="n">matches</span><span class="si">}</span><span class="s2">&quot;</span>
</span></code></pre></div></p>
<p><strong>High Memory Usage</strong>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="c1"># Monitor queue lengths</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="n">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">transport</span><span class="o">.</span><span class="n">queue_stats</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="n">long_queues</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stats</span><span class="o">.</span><span class="n">select</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">|</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="o">|</span><span class="w"> </span><span class="n">info</span><span class="o">[</span><span class="ss">:length</span><span class="o">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Long queues: </span><span class="si">#{</span><span class="n">long_queues</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a>
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a><span class="c1"># Configure queue limits</span>
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a><span class="n">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">SmartMessage</span><span class="o">::</span><span class="no">Transport</span><span class="o">::</span><span class="no">RedisQueueTransport</span><span class="o">.</span><span class="n">new</span><span class="p">({</span>
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a><span class="w">  </span><span class="ss">max_queue_length</span><span class="p">:</span><span class="w"> </span><span class="mi">5000</span><span class="w">  </span><span class="c1"># Trim at 5k messages</span>
</span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a><span class="p">})</span>
</span></code></pre></div></p>
<p><strong>Consumer Not Receiving Messages</strong>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="c1"># Check consumer group membership</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="n">consumer_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">transport</span><span class="o">.</span><span class="n">consumer_group_info</span><span class="p">(</span><span class="s2">&quot;my_workers&quot;</span><span class="p">)</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Consumers: </span><span class="si">#{</span><span class="n">consumer_info</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="c1"># Verify routing table</span>
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="n">routing_table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">transport</span><span class="o">.</span><span class="n">routing_table</span>
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Routing table: </span><span class="si">#{</span><span class="n">routing_table</span><span class="si">}</span><span class="s2">&quot;</span>
</span></code></pre></div></p>
<h3 id="debug-mode">Debug Mode<a class="headerlink" href="#debug-mode" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="c1"># Enable comprehensive debugging</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="n">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">SmartMessage</span><span class="o">::</span><span class="no">Transport</span><span class="o">::</span><span class="no">RedisQueueTransport</span><span class="o">.</span><span class="n">new</span><span class="p">({</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="w">  </span><span class="ss">debug</span><span class="p">:</span><span class="w"> </span><span class="kp">true</span><span class="p">,</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="w">  </span><span class="ss">log_level</span><span class="p">:</span><span class="w"> </span><span class="ss">:debug</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="p">})</span>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="c1"># Monitor Redis commands</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a><span class="c1"># In separate terminal: redis-cli MONITOR</span>
</span></code></pre></div>
<h3 id="performance-debugging">Performance Debugging<a class="headerlink" href="#performance-debugging" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="c1"># Measure publishing performance</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="n">start_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">Time</span><span class="o">.</span><span class="n">now</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="mi">1000</span><span class="o">.</span><span class="n">times</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">|</span><span class="n">i</span><span class="o">|</span><span class="w"> </span><span class="no">TestMessage</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">publish</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="n">duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_time</span>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Published 1000 messages in </span><span class="si">#{</span><span class="n">duration</span><span class="si">}</span><span class="s2">s (</span><span class="si">#{</span><span class="mi">1000</span><span class="o">/</span><span class="n">duration</span><span class="si">}</span><span class="s2"> msg/s)&quot;</span>
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="c1"># Measure processing performance</span>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a><span class="n">processed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a><span class="n">start_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">Time</span><span class="o">.</span><span class="n">now</span>
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a>
</span><span id="__span-40-11"><a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a><span class="n">transport</span><span class="o">.</span><span class="n">subscribe_pattern</span><span class="p">(</span><span class="s2">&quot;#.*.*&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">message_class</span><span class="p">,</span><span class="w"> </span><span class="n">message_data</span><span class="o">|</span>
</span><span id="__span-40-12"><a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a><span class="w">  </span><span class="n">processed</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-40-13"><a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">processed</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-40-14"><a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a><span class="w">    </span><span class="n">rate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">processed</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_time</span><span class="p">)</span>
</span><span id="__span-40-15"><a id="__codelineno-40-15" name="__codelineno-40-15" href="#__codelineno-40-15"></a><span class="w">    </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;Processed </span><span class="si">#{</span><span class="n">processed</span><span class="si">}</span><span class="s2"> messages (</span><span class="si">#{</span><span class="n">rate</span><span class="si">}</span><span class="s2"> msg/s)&quot;</span>
</span><span id="__span-40-16"><a id="__codelineno-40-16" name="__codelineno-40-16" href="#__codelineno-40-16"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-40-17"><a id="__codelineno-40-17" name="__codelineno-40-17" href="#__codelineno-40-17"></a><span class="k">end</span>
</span></code></pre></div>
<h2 id="api-reference">API Reference<a class="headerlink" href="#api-reference" title="Permanent link">&para;</a></h2>
<h3 id="transport-class">Transport Class<a class="headerlink" href="#transport-class" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">SmartMessage</span><span class="o">::</span><span class="no">Transport</span><span class="o">::</span><span class="no">RedisQueueTransport</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="no">Base</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="w">  </span><span class="c1"># Configuration</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">initialize</span><span class="p">(</span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">configure</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">connected?</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">connect</span>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">disconnect</span>
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a>
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a><span class="w">  </span><span class="c1"># Publishing</span>
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">do_publish</span><span class="p">(</span><span class="n">message_class</span><span class="p">,</span><span class="w"> </span><span class="n">serialized_message</span><span class="p">)</span>
</span><span id="__span-41-11"><a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a>
</span><span id="__span-41-12"><a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a><span class="w">  </span><span class="c1"># Subscriptions</span>
</span><span id="__span-41-13"><a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">subscribe</span><span class="p">(</span><span class="n">message_class</span><span class="p">,</span><span class="w"> </span><span class="n">process_method</span><span class="p">,</span><span class="w"> </span><span class="n">filter_options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-41-14"><a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">subscribe_pattern</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
</span><span id="__span-41-15"><a id="__codelineno-41-15" name="__codelineno-41-15" href="#__codelineno-41-15"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">unsubscribe</span><span class="p">(</span><span class="n">message_class</span><span class="p">,</span><span class="w"> </span><span class="n">process_method</span><span class="p">)</span>
</span><span id="__span-41-16"><a id="__codelineno-41-16" name="__codelineno-41-16" href="#__codelineno-41-16"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">unsubscribe!</span><span class="p">(</span><span class="n">message_class</span><span class="p">)</span>
</span><span id="__span-41-17"><a id="__codelineno-41-17" name="__codelineno-41-17" href="#__codelineno-41-17"></a>
</span><span id="__span-41-18"><a id="__codelineno-41-18" name="__codelineno-41-18" href="#__codelineno-41-18"></a><span class="w">  </span><span class="c1"># Convenience methods</span>
</span><span id="__span-41-19"><a id="__codelineno-41-19" name="__codelineno-41-19" href="#__codelineno-41-19"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">subscribe_to_recipient</span><span class="p">(</span><span class="n">recipient_id</span><span class="p">)</span>
</span><span id="__span-41-20"><a id="__codelineno-41-20" name="__codelineno-41-20" href="#__codelineno-41-20"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">subscribe_from_sender</span><span class="p">(</span><span class="n">sender_id</span><span class="p">)</span>
</span><span id="__span-41-21"><a id="__codelineno-41-21" name="__codelineno-41-21" href="#__codelineno-41-21"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">subscribe_to_type</span><span class="p">(</span><span class="n">message_type</span><span class="p">)</span>
</span><span id="__span-41-22"><a id="__codelineno-41-22" name="__codelineno-41-22" href="#__codelineno-41-22"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">subscribe_to_broadcasts</span>
</span><span id="__span-41-23"><a id="__codelineno-41-23" name="__codelineno-41-23" href="#__codelineno-41-23"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">subscribe_to_alerts</span>
</span><span id="__span-41-24"><a id="__codelineno-41-24" name="__codelineno-41-24" href="#__codelineno-41-24"></a>
</span><span id="__span-41-25"><a id="__codelineno-41-25" name="__codelineno-41-25" href="#__codelineno-41-25"></a><span class="w">  </span><span class="c1"># Fluent API</span>
</span><span id="__span-41-26"><a id="__codelineno-41-26" name="__codelineno-41-26" href="#__codelineno-41-26"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">where</span>
</span><span id="__span-41-27"><a id="__codelineno-41-27" name="__codelineno-41-27" href="#__codelineno-41-27"></a>
</span><span id="__span-41-28"><a id="__codelineno-41-28" name="__codelineno-41-28" href="#__codelineno-41-28"></a><span class="w">  </span><span class="c1"># Management</span>
</span><span id="__span-41-29"><a id="__codelineno-41-29" name="__codelineno-41-29" href="#__codelineno-41-29"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">queue_stats</span>
</span><span id="__span-41-30"><a id="__codelineno-41-30" name="__codelineno-41-30" href="#__codelineno-41-30"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">routing_table</span>
</span><span id="__span-41-31"><a id="__codelineno-41-31" name="__codelineno-41-31" href="#__codelineno-41-31"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">queue_length</span><span class="p">(</span><span class="n">queue_name</span><span class="p">)</span>
</span><span id="__span-41-32"><a id="__codelineno-41-32" name="__codelineno-41-32" href="#__codelineno-41-32"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">clear_queue</span><span class="p">(</span><span class="n">queue_name</span><span class="p">)</span>
</span><span id="__span-41-33"><a id="__codelineno-41-33" name="__codelineno-41-33" href="#__codelineno-41-33"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">clear_all_queues</span>
</span><span id="__span-41-34"><a id="__codelineno-41-34" name="__codelineno-41-34" href="#__codelineno-41-34"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">consumer_group_info</span><span class="p">(</span><span class="n">group_name</span><span class="p">)</span>
</span><span id="__span-41-35"><a id="__codelineno-41-35" name="__codelineno-41-35" href="#__codelineno-41-35"></a>
</span><span id="__span-41-36"><a id="__codelineno-41-36" name="__codelineno-41-36" href="#__codelineno-41-36"></a><span class="w">  </span><span class="c1"># Health and monitoring</span>
</span><span id="__span-41-37"><a id="__codelineno-41-37" name="__codelineno-41-37" href="#__codelineno-41-37"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">health_check</span>
</span><span id="__span-41-38"><a id="__codelineno-41-38" name="__codelineno-41-38" href="#__codelineno-41-38"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">performance_metrics</span>
</span><span id="__span-41-39"><a id="__codelineno-41-39" name="__codelineno-41-39" href="#__codelineno-41-39"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">dead_letter_stats</span>
</span><span id="__span-41-40"><a id="__codelineno-41-40" name="__codelineno-41-40" href="#__codelineno-41-40"></a><span class="k">end</span>
</span></code></pre></div>
<h3 id="fluent-api-builder">Fluent API Builder<a class="headerlink" href="#fluent-api-builder" title="Permanent link">&para;</a></h3>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">SmartMessage</span><span class="o">::</span><span class="no">Transport</span><span class="o">::</span><span class="no">RedisQueueSubscriptionBuilder</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">from</span><span class="p">(</span><span class="n">sender_id</span><span class="p">)</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">to</span><span class="p">(</span><span class="n">recipient_id</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">type</span><span class="p">(</span><span class="n">message_type</span><span class="p">)</span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">consumer_group</span><span class="p">(</span><span class="n">group_name</span><span class="p">)</span>
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">build</span><span class="w">  </span><span class="c1"># Returns pattern string</span>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">subscribe</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span><span class="w">  </span><span class="c1"># Subscribes with built pattern</span>
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a><span class="k">end</span>
</span></code></pre></div>
<h2 id="configuration-reference">Configuration Reference<a class="headerlink" href="#configuration-reference" title="Permanent link">&para;</a></h2>
<h3 id="transport-options">Transport Options<a class="headerlink" href="#transport-options" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>url</code></td>
<td>String</td>
<td><code>redis://localhost:6379</code></td>
<td>Redis connection URL</td>
</tr>
<tr>
<td><code>db</code></td>
<td>Integer</td>
<td><code>0</code></td>
<td>Redis database number</td>
</tr>
<tr>
<td><code>queue_prefix</code></td>
<td>String</td>
<td><code>smart_message.queue</code></td>
<td>Prefix for queue names</td>
</tr>
<tr>
<td><code>consumer_group</code></td>
<td>String</td>
<td><code>default_workers</code></td>
<td>Consumer group name</td>
</tr>
<tr>
<td><code>consumer_id</code></td>
<td>String</td>
<td><code>#{hostname}_#{pid}</code></td>
<td>Unique consumer identifier</td>
</tr>
<tr>
<td><code>block_time</code></td>
<td>Integer</td>
<td><code>1000</code></td>
<td>Blocking timeout in milliseconds</td>
</tr>
<tr>
<td><code>max_queue_length</code></td>
<td>Integer</td>
<td><code>10000</code></td>
<td>Maximum messages per queue</td>
</tr>
<tr>
<td><code>batch_size</code></td>
<td>Integer</td>
<td><code>1</code></td>
<td>Messages to process per batch</td>
</tr>
<tr>
<td><code>max_retries</code></td>
<td>Integer</td>
<td><code>3</code></td>
<td>Maximum retry attempts</td>
</tr>
<tr>
<td><code>retry_delay</code></td>
<td>Integer</td>
<td><code>5</code></td>
<td>Seconds between retries</td>
</tr>
<tr>
<td><code>exponential_backoff</code></td>
<td>Boolean</td>
<td><code>false</code></td>
<td>Use exponential backoff for retries</td>
</tr>
<tr>
<td><code>dead_letter_queue</code></td>
<td>Boolean</td>
<td><code>false</code></td>
<td>Enable dead letter queue</td>
</tr>
<tr>
<td><code>dead_letter_prefix</code></td>
<td>String</td>
<td><code>dlq</code></td>
<td>Prefix for dead letter queues</td>
</tr>
<tr>
<td><code>circuit_breaker</code></td>
<td>Boolean</td>
<td><code>false</code></td>
<td>Enable circuit breaker</td>
</tr>
<tr>
<td><code>failure_threshold</code></td>
<td>Integer</td>
<td><code>5</code></td>
<td>Circuit breaker failure threshold</td>
</tr>
<tr>
<td><code>recovery_timeout</code></td>
<td>Integer</td>
<td><code>60</code></td>
<td>Circuit breaker recovery timeout</td>
</tr>
<tr>
<td><code>pool_size</code></td>
<td>Integer</td>
<td><code>1</code></td>
<td>Connection pool size</td>
</tr>
<tr>
<td><code>pool_timeout</code></td>
<td>Integer</td>
<td><code>1</code></td>
<td>Connection pool timeout</td>
</tr>
<tr>
<td><code>debug</code></td>
<td>Boolean</td>
<td><code>false</code></td>
<td>Enable debug logging</td>
</tr>
</tbody>
</table>
<h2 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">&para;</a></h2>
<p>The <code>examples/redis_queue/</code> directory contains comprehensive, production-ready examples demonstrating Redis Queue Transport capabilities:</p>
<h3 id="core-queue-messaging">Core Queue Messaging<a class="headerlink" href="#core-queue-messaging" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><a href="https://github.com/MadBomber/smart_message/blob/main/examples/redis_queue/01_basic_messaging.rb">01_basic_messaging.rb</a></strong> - Foundation queue messaging patterns</li>
<li>Basic message publishing and consumption</li>
<li>Consumer group configuration</li>
<li>
<p>Queue-based message processing</p>
</li>
<li>
<p><strong><a href="https://github.com/MadBomber/smart_message/blob/main/examples/redis_queue/01_comprehensive_examples.rb">01_comprehensive_examples.rb</a></strong> - Complete feature demonstration</p>
</li>
<li>All Redis Queue Transport capabilities in one example</li>
<li>Pattern routing, load balancing, error handling</li>
<li>Production patterns and best practices</li>
</ul>
<h3 id="advanced-routing-patterns">Advanced Routing &amp; Patterns<a class="headerlink" href="#advanced-routing-patterns" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><a href="https://github.com/MadBomber/smart_message/blob/main/examples/redis_queue/02_pattern_routing.rb">02_pattern_routing.rb</a></strong> - RabbitMQ-style pattern routing</li>
<li>Topic-based routing with patterns</li>
<li>Wildcard subscriptions (<code>#</code>, <code>*</code>)</li>
<li>
<p>Complex routing scenarios</p>
</li>
<li>
<p><strong><a href="https://github.com/MadBomber/smart_message/blob/main/examples/redis_queue/03_fluent_api.rb">03_fluent_api.rb</a></strong> - Fluent API usage examples</p>
</li>
<li>Chain-based subscription configuration</li>
<li>Dynamic routing with builder pattern</li>
<li>Readable subscription management</li>
</ul>
<h3 id="production-features">Production Features<a class="headerlink" href="#production-features" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><a href="https://github.com/MadBomber/smart_message/blob/main/examples/redis_queue/04_load_balancing.rb">04_load_balancing.rb</a></strong> - Load balancing across workers</li>
<li>Consumer group scaling</li>
<li>Work distribution patterns</li>
<li>
<p>High-availability setups</p>
</li>
<li>
<p><strong><a href="https://github.com/MadBomber/smart_message/blob/main/examples/redis_queue/05_microservices.rb">05_microservices.rb</a></strong> - Microservices communication</p>
</li>
<li>Service-to-service messaging</li>
<li>Distributed system coordination</li>
<li>
<p>Cross-service event handling</p>
</li>
<li>
<p><strong><a href="https://github.com/MadBomber/smart_message/blob/main/examples/redis_queue/06_emergency_alerts.rb">06_emergency_alerts.rb</a></strong> - Emergency alert system</p>
</li>
<li>Priority message handling</li>
<li>Alert escalation workflows</li>
<li>
<p>Critical message processing</p>
</li>
<li>
<p><strong><a href="https://github.com/MadBomber/smart_message/blob/main/examples/redis_queue/07_queue_management.rb">07_queue_management.rb</a></strong> - Queue management utilities</p>
</li>
<li>Queue monitoring and statistics</li>
<li>Dead letter queue handling</li>
<li>Performance optimization techniques</li>
</ul>
<h3 id="enhanced-transport-integration">Enhanced Transport Integration<a class="headerlink" href="#enhanced-transport-integration" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><a href="https://github.com/MadBomber/smart_message/blob/main/examples/redis_queue/enhanced_01_basic_patterns.rb">enhanced_01_basic_patterns.rb</a></strong> - Enhanced transport patterns</li>
<li><strong><a href="https://github.com/MadBomber/smart_message/blob/main/examples/redis_queue/enhanced_02_fluent_api.rb">enhanced_02_fluent_api.rb</a></strong> - Enhanced fluent API</li>
<li><strong><a href="https://github.com/MadBomber/smart_message/blob/main/examples/redis_queue/enhanced_03_dual_publishing.rb">enhanced_03_dual_publishing.rb</a></strong> - Dual publishing strategies</li>
<li><strong><a href="https://github.com/MadBomber/smart_message/blob/main/examples/redis_queue/enhanced_04_advanced_routing.rb">enhanced_04_advanced_routing.rb</a></strong> - Advanced routing scenarios</li>
</ul>
<h3 id="key-features-demonstrated">Key Features Demonstrated<a class="headerlink" href="#key-features-demonstrated" title="Permanent link">&para;</a></h3>
<p>The Redis Queue examples showcase enterprise-grade messaging capabilities:
- <strong>Persistent Queues</strong> - Guaranteed message delivery with Redis Streams
- <strong>Load Balancing</strong> - Work distribution across consumer groups
- <strong>Pattern Routing</strong> - RabbitMQ-style topic routing (<code>user.orders.#</code>)
- <strong>Dead Letter Queues</strong> - Failed message handling and replay
- <strong>Circuit Breakers</strong> - Resilient error handling and recovery
- <strong>Performance Monitoring</strong> - Queue statistics and health monitoring
- <strong>Fluent API</strong> - Builder pattern for complex subscriptions</p>
<h3 id="running-examples">Running Examples<a class="headerlink" href="#running-examples" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="c1"># Prerequisites: Start Redis server (version 5.0+)</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>redis-server
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="c1"># Navigate to the SmartMessage directory</span>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="nb">cd</span><span class="w"> </span>smart_message
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a>
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="c1"># Run queue transport examples</span>
</span><span id="__span-43-8"><a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a>ruby<span class="w"> </span>examples/redis_queue/01_basic_messaging.rb
</span><span id="__span-43-9"><a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a>ruby<span class="w"> </span>examples/redis_queue/02_pattern_routing.rb
</span><span id="__span-43-10"><a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a>ruby<span class="w"> </span>examples/redis_queue/04_load_balancing.rb
</span><span id="__span-43-11"><a id="__codelineno-43-11" name="__codelineno-43-11" href="#__codelineno-43-11"></a>
</span><span id="__span-43-12"><a id="__codelineno-43-12" name="__codelineno-43-12" href="#__codelineno-43-12"></a><span class="c1"># Monitor queue activity</span>
</span><span id="__span-43-13"><a id="__codelineno-43-13" name="__codelineno-43-13" href="#__codelineno-43-13"></a>redis-cli<span class="w"> </span>XINFO<span class="w"> </span>GROUPS<span class="w"> </span>smart_message.queue.TestMessage
</span><span id="__span-43-14"><a id="__codelineno-43-14" name="__codelineno-43-14" href="#__codelineno-43-14"></a>redis-cli<span class="w"> </span>XLEN<span class="w"> </span>smart_message.queue.TestMessage
</span></code></pre></div>
<h3 id="example-patterns">Example Patterns<a class="headerlink" href="#example-patterns" title="Permanent link">&para;</a></h3>
<p>The queue examples demonstrate these routing patterns:
- <strong>Service patterns</strong>: <code>user.orders.#</code>, <code>payment.*.processed</code>
- <strong>Priority routing</strong>: <code>urgent.*</code>, <code>normal.*</code>, <code>bulk.*</code>
- <strong>Geographic routing</strong>: <code>*.us-east.#</code>, <code>*.eu-west.#</code>
- <strong>System patterns</strong>: <code>system.alerts.#</code>, <code>monitoring.*.stats</code></p>
<h3 id="production-features_1">Production Features<a class="headerlink" href="#production-features_1" title="Permanent link">&para;</a></h3>
<p>The Redis Queue examples demonstrate enterprise requirements:
- <strong>High Availability</strong> - Consumer group failover and recovery
- <strong>Scalability</strong> - Horizontal scaling with multiple workers
- <strong>Durability</strong> - Message persistence with Redis Streams
- <strong>Observability</strong> - Comprehensive monitoring and metrics
- <strong>Error Handling</strong> - Dead letter queues and retry mechanisms</p>
<p>Each example includes detailed logging, error handling, and demonstrates production-ready patterns for mission-critical messaging systems.</p>
<h3 id="additional-resources">Additional Resources<a class="headerlink" href="#additional-resources" title="Permanent link">&para;</a></h3>
<p>For comprehensive Redis Queue documentation:
- <strong><a href="../../guides/redis-queue-getting-started/">Redis Queue Getting Started Guide</a></strong> - Step-by-step setup
- <strong><a href="../../guides/redis-queue-production/">Redis Queue Production Guide</a></strong> - Production deployment
- <strong><a href="../../guides/redis-queue-patterns/">Redis Queue Patterns Guide</a></strong> - Advanced messaging patterns</p>
<h2 id="related-documentation">Related Documentation<a class="headerlink" href="#related-documentation" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="../redis-transport/">Redis Transport</a> - Basic Redis pub/sub transport</li>
<li><a href="../redis-enhanced-transport/">Redis Enhanced Transport</a> - Enhanced routing capabilities  </li>
<li><a href="../redis-transport-comparison/">Transport Comparison</a> - Compare all Redis transports</li>
<li><a href="../../reference/transports/">Transport Overview</a> - All available transports</li>
</ul>
<p>The Redis Queue Transport represents the pinnacle of SmartMessage's transport evolution, combining the simplicity of Redis with the sophistication of enterprise message brokers. Its unique architecture delivers both the performance characteristics developers need and the routing intelligence that complex applications demand.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 madbomber
    </div>
  
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://github.com/madbomber/smart_message" target="_blank" rel="noopener" title="GitHub Repository" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.path", "navigation.indexes", "navigation.top", "toc.follow", "search.suggest", "search.highlight", "search.share", "header.autohide", "content.code.copy", "content.code.annotate", "content.tabs.link", "content.tooltips", "content.action.edit", "content.action.view"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": "0.1.11"}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
        <script src="../../assets/javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>